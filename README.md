# Prot√≥tipo de projeto: negocia.ai
## Jo√£o Victor de Souza Campos | Nataly de Souza Cunha | Yasmin Ingrid Silva Min√°rio
## üáßüá∑ Brasil

## 1. Introdu√ß√£o

O mercado de **empr√©stimos peer-to-peer (P2P)** tem ganhado for√ßa globalmente ao oferecer cr√©dito de forma direta entre pessoas, sem intermedi√°rios tradicionais como bancos. Essa modalidade promete mais agilidade, taxas potencialmente melhores e inclus√£o financeira de p√∫blicos que ficam √† margem do sistema banc√°rio. No entanto, ainda enfrenta problemas de confian√ßa, rigidez nas regras e dificuldade de avaliar riscos de cr√©dito com transpar√™ncia. Al√©m disso, os usu√°rios que oferecem empr√©stimos ficam expostos a riscos adicionais: em casos de imprevistos do tomador, podem ser obrigados a assumir perdas ou enfrentar atrasos na recupera√ß√£o do capital, o que aumenta o custo, a incerteza e reduz a atratividade de emprestar na plataforma.

√â nesse contexto que surge o **negocia.ai**, um aplicativo de cr√©dito P2P que busca resolver as falhas atuais do setor e criar um ambiente mais justo, flex√≠vel e confi√°vel para tomadores e investidores.

---

## 2. Problema
O acesso a cr√©dito no modelo P2P tradicional ‚Äî e em muitos protocolos descentralizados ‚Äî ainda enfrenta barreiras significativas:

1. **Rigidez dos protocolos atuais (over-collateralized)**  
   A exig√™ncia de colaterais maiores que o valor do empr√©stimo restringe o acesso apenas a quem j√° tem liquidez, excluindo grande parte dos potenciais usu√°rios.

2. **Aus√™ncia de di√°logo entre as partes**  
   Plataformas automatizadas fixam taxas e prazos de forma imut√°vel, sem espa√ßo para negocia√ß√£o ou contraproposta. Isso reduz flexibilidade e ignora o perfil individual do tomador ou o apetite de risco do investidor.

3. **Assimetria de informa√ß√£o e fragilidade na an√°lise de cr√©dito**  
   Investidores t√™m dificuldade em avaliar o risco de emprestar devido √† falta de dados ou crit√©rios limitados. Sem m√©tricas confi√°veis, a inseguran√ßa reduz o incentivo a participar.

4. **Execu√ß√£o fr√°gil de contratos**  
   Sem garantias autom√°ticas de cumprimento das condi√ß√µes acordadas, negocia√ß√µes podem perder credibilidade e se tornar pouco confi√°veis.

4. **Vulnerabilidade dos Investidores**  
   Os investidores que disponibilizam capital em plataformas P2P ficam expostos a diversos imprevistos relacionados ao comportamento ou √† capacidade de pagamento dos tomadores:
    - Inadimpl√™ncia total ou parcial: atraso ou falta de pagamento do principal e/ou juros.
    - Risco de recupera√ß√£o: custos, tempo e efici√™ncia reduzida na cobran√ßa e recupera√ß√£o de cr√©dito.
    - Risco de liquidez: dificuldade em liquidar posi√ß√µes antes do vencimento, especialmente em contratos personalizados.
    - Risco de concentra√ß√£o: exposi√ß√£o excessiva a um mesmo tomador, setor ou perfil de risco.

**Impactos:**
- Exclus√£o de usu√°rios com baixo acesso a colateral.
- Baixa ades√£o de investidores por medo de inadimpl√™ncia.
- Experi√™ncia de uso limitada e desconfian√ßa no sistema.
- Perda de efici√™ncia em rela√ß√£o ao potencial do cr√©dito P2P.

---

## 3. Solu√ß√£o Proposta
O **negocia.ai** √© uma plataforma P2P de cr√©dito que conecta tomadores e investidores em um ambiente seguro, transparente e com espa√ßo para negocia√ß√£o direta. A solu√ß√£o se apoia em tr√™s pilares principais:

- **Negocia√ß√£o flex√≠vel**: tomadores e investidores podem fazer contrapropostas em taxa e prazo, recriando a din√¢mica de negocia√ß√£o do mundo real, mas com garantias digitais.  
- **An√°lise de cr√©dito transparente**: cada usu√°rio recebe um score de cr√©dito consolidado a partir de fontes externas (ex.: Serasa) e hist√≥rico interno da plataforma, reduzindo assimetria de informa√ß√£o e apoiando decis√µes mais seguras.  
- **Execu√ß√£o confi√°vel**: contratos s√£o formalizados digitalmente, garantindo rastreabilidade, clareza e automa√ß√£o de etapas cr√≠ticas.  
- **Antecipa√ß√£o de parcelas por investidores**  
    Permite que investidores antecipem receb√≠veis (parcelas futuras) cedendo parte do valor √† institui√ß√£o financeira parceira que integra a plataforma.  
    - Mecanismo: o investidor transfere o direito de receber parcelas futuras em troca de pagamento imediato com desconto (comiss√£o/√°gio) feito pela institui√ß√£o integradora.  
    - Efeitos: fornece liquidez imediata ao investidor, reduz risco de descapitaliza√ß√£o e diminui exposi√ß√£o a perda futura; a institui√ß√£o assume parte do risco em troca da margem aplicada.  

**Diferenciais em rela√ß√£o a solu√ß√µes existentes**:
- Espa√ßo real de negocia√ß√£o, e n√£o apenas ‚Äútake it or leave it‚Äù.
- Score h√≠brido (interno + externo), adaptado ao perfil e hist√≥rico do usu√°rio.
- Transpar√™ncia e rastreabilidade em todas as etapas, fortalecendo a confian√ßa.

**Principais benef√≠cios:**
- **Tomadores**: acesso a cr√©dito justo e flex√≠vel, mesmo sem colateral elevado.
- **Investidores**: maior clareza sobre risco, suporte na diversifica√ß√£o e prote√ß√£o contra inadimpl√™ncia.
- **Mercado**: inclus√£o financeira, mais efici√™ncia e fortalecimento do modelo P2P.

---

## 4. Objetivos do Projeto

### Objetivo Geral
Desenvolver uma plataforma de cr√©dito P2P que reduza barreiras de acesso, aumente a confian√ßa entre as partes e ofere√ßa um sistema de negocia√ß√£o transparente, flex√≠vel e seguro.

### Objetivos Espec√≠ficos
- Criar um **sistema de cadastro e valida√ß√£o antifraude** para onboarding confi√°vel.
- Implementar um **motor de score h√≠brido (interno + externo)** para avalia√ß√£o de risco.
- Oferecer **funcionalidades de solicita√ß√£o e oferta de cr√©dito** com espa√ßo para contraproposta.
- Desenvolver dashboards personalizados para **monitorar carteira, risco e hist√≥rico**.
- Garantir **execu√ß√£o autom√°tica e rastre√°vel** dos contratos.
- Desenvolver funcionalidades de **antecipa√ß√£o de receb√≠veis** para os investidores da plataforma.
 
---

# üöÄ Como Testar e Rodar o Negocia.ai

## 1Ô∏è‚É£ Pr√©-requisitos

- [Docker](https://www.docker.com/get-started) instalado
- [Node.js](https://nodejs.org/) (para rodar o frontend)
- [Git](https://git-scm.com/) para clonar o projeto

---

## 2Ô∏è‚É£ Clonando o Projeto

```bash
git clone https://github.com/yasminminario/negocia-invest
cd negocia-invest
```

---

## 3Ô∏è‚É£ Rodando Backend + Banco de Dados (Docker Compose)

No diret√≥rio raiz (cd src), execute:

```bash
docker-compose up --build
```

Isso ir√° subir:
- Backend FastAPI (porta padr√£o: `8000`)
- Banco de dados PostgreSQL (porta padr√£o: `5432`)

> **Dica:** O backend j√° est√° configurado para se conectar ao banco via Docker. As credenciais est√£o no arquivo `.env`. Al√©m disso, os pacotes necess√°rios j√° est√£o configurados a serem instalados automaticamente.

---

## 5Ô∏è‚É£ Rodando o Frontend (React)

Entre na pasta do frontend:

```bash
cd src/frontend/
```

Instale as depend√™ncias:

```bash
npm install
```

Inicie o app:

```bash
npm run dev
```

> O frontend ir√° se conectar ao backend na porta `8000`.

---

## 6Ô∏è‚É£ Testando a Solu√ß√£o

- **Acesse o app web** pelo navegador ou emulador.
- **Fa√ßa o cadastro** como tomador ou investidor.
- **Simule negocia√ß√µes, propostas e antecipa√ß√£o de receb√≠veis**.
- **Verifique registros no banco** e hashes na blockchain (se configurado).

---

## 7Ô∏è‚É£ Parando os Servi√ßos

Para encerrar tudo:

```bash
docker-compose down
```

## üö∂‚Äç‚û°Ô∏è Personas

### üßë Persona 1: O Tomador Planejado (Carlos)

**Nome:**	Carlos, 30 anos <Br>
**Profiss√£o:**	Profissional de TI <br> 
**Score:**	Excelente (790) <Br>

### Cen√°rio:
Carlos √© um profissional dedicado e financeiramente respons√°vel. Ele sempre pagou suas contas em dia e construiu um √≥timo score de cr√©dito ao longo dos anos. Ele quer fazer um curso de especializa√ß√£o em Intelig√™ncia Artificial que custa R$10.000, um investimento que pode alavancar seu sal√°rio em at√© 30% em um ano, mas ele n√£o quer descapitalizar sua reserva de emerg√™ncia.

### Objetivos:

- Conseguir um empr√©stimo de R$10.000 com o m√≠nimo de burocracia.

- Pagar uma taxa de juros justa, que reflita seu status de excelente pagador.

- Sentir que seu bom comportamento financeiro √© reconhecido e recompensado.

### Frustra√ß√µes (A Jornada que o trouxe at√© aqui):

- **A Frustra√ß√£o com os Grandes Bancos:** Carlos primeiro foi ao seu banco tradicional. Por ser cliente h√° anos, achou que teria uma boa oferta. O banco lhe ofereceu um cr√©dito pr√©-aprovado, mas com uma taxa de juros padr√£o, alta, a mesma que ofereceriam para algu√©m com score muito inferior. Ele se sentiu apenas mais um n√∫mero em uma planilha, e seu bom hist√≥rico n√£o valeu nada.

- **A Frustra√ß√£o com as Fintechs Tradicionais:** Em seguida, ele tentou uma fintech de cr√©dito conhecida. O processo foi r√°pido e digital, mas o algoritmo, apesar de reconhecer seu bom score, s√≥ liberou um limite de R$7.500 ‚Äì insuficiente para seu curso. N√£o havia canal para explicar seu objetivo ou para solicitar uma reavalia√ß√£o. A decis√£o foi final, fria e sem espa√ßo para di√°logo.

- **A Dor Principal do Carlos:** Ele percebe uma grande injusti√ßa no mercado. *"De que adianta eu ser um √≥timo pagador e ter um score excelente se, no final, sou tratado com as mesmas taxas abusivas ou com limites que n√£o atendem minha necessidade? Eu n√£o quero um favor, quero uma condi√ß√£o justa pelo meu bom perfil."*

### üë© Persona 2: A Investidora Estrat√©gica (Sofia)
**Nome:**	Sofia, 45 anos <br>
**Profiss√£o:**	Gerente de Projetos <br>
**Perfil de Investidora:**	Moderado <br>

### Cen√°rio:
Sofia tem um bom capital guardado e busca diversificar seus investimentos. Ela j√° investe em op√ß√µes de renda fixa (CDB, Tesouro), mas est√° frustrada com a baixa rentabilidade. Ela tamb√©m tem a√ß√µes, mas n√£o gosta da volatilidade e da falta de controle.

### Objetivos:

- Obter uma rentabilidade superior √† da renda fixa tradicional.

- Investir em ativos com um risco controlado e previs√≠vel.

- Ter transpar√™ncia e controle sobre onde seu dinheiro est√° alocado.

### Frustra√ß√µes (O que a faz buscar alternativas):

- **Renda Fixa:** Retornos muito baixos, mal acompanham a infla√ß√£o.

- **Bolsa de Valores:** Muita volatilidade e requer um acompanhamento constante que ela n√£o tem tempo para fazer.

- **Outras Plataformas P2P:** Ela j√° explorou outras plataformas P2P, mas o modelo era uma "caixa-preta". Ela colocava o dinheiro em um "fundo" de risco moderado, mas n√£o sabia exatamente para quem estava emprestando. Ela n√£o tinha poder de escolha ou negocia√ß√£o.

- **A Oportunidade que Sofia V√™:** *"Eu quero investir em pessoas, n√£o apenas em siglas. Se uma plataforma pudesse me apresentar uma carteira de tomadores j√° pr√©-selecionados, com os melhores scores do Brasil, e me desse a chance de negociar um retorno justo diretamente com eles, eu teria o melhor dos dois mundos: risco baixo e rentabilidade atrativa."*

---

## üîµ Fluxo 1: Jornada do Tomador (Carlos) ‚Äì O Fluxo Principal

Jornada mais detalhada do prot√≥tipo, desde o **cadastro at√© a negocia√ß√£o** de um empr√©stimo.

### 1. Cadastro e Onboarding *(Cadastro 1-4 a 4-4)*
- Cria√ß√£o de conta com e-mail e senha.  
- Preenchimento de dados pessoais para an√°lise de cr√©dito.  
- Verifica√ß√£o facial (KYC ‚Äì *Know Your Customer*).  
- Tela final de sucesso com direcionamento para login.  

### 2. Login e Sele√ß√£o de Perfil *(Entrar 1-2, Entrar 2-2)*
- Ap√≥s login, usu√°rio escolhe entre **Tomador** ou **Investidor**.  
- Cards explicativos orientam sobre cada perfil.  
- Lembrete de como alternar entre perfis posteriormente.  

### 3. Dashboard do Tomador *(Dashboard Tomador)*
- **Anel de score** em destaque, com feedback visual do cr√©dito.  
- Cards de **Produtos ativos**: *Empr√©stimos* e *Negocia√ß√µes*.  
- Pontos de entrada para:  
  - Empr√©stimos Solicitados.  
  - Negocia√ß√µes de Ofertas (Tomador).  

### 4. O Core da Solu√ß√£o ‚Äì A Negocia√ß√£o
- **Passo 4a ‚Äì Descoberta**: Dashboard ‚Üí Detalhes da oferta.  
  - Lista de empr√©stimos dispon√≠veis.  
  - Usu√°rio visualiza condi√ß√µes propostas.  

- **Passo 4b ‚Äì A√ß√£o**: Detalhes da oferta.  
  - Op√ß√µes: *Aceitar oferta* ou *Iniciar negocia√ß√£o* (CTA principal).  

- **Passo 4c ‚Äì A Proposta** *(Negocia√ß√£o 1-2)*  
  - Compara√ß√£o entre oferta original e proposta do usu√°rio.  
  - Ajuste de taxa em *slider* com ‚ÄúZona sugerida‚Äù.  
  - Visualiza√ß√£o em tempo real da economia estimada.  
  - Justificativa escrita para humanizar a negocia√ß√£o.  

- **Passo 4d ‚Äì Sucesso** *(Negocia√ß√£o 2-2)*  
  - Confirma√ß√£o da proposta enviada.  
  - Orienta√ß√£o para acompanhar via notifica√ß√µes.  

---

## üü£ Fluxo 2: Jornada da Investidora (Sofia) ‚Äì O Fluxo Complementar

Prototipado para mostrar momentos cr√≠ticos de intera√ß√£o, mantendo consist√™ncia com o fluxo do Tomador.

### 1. Dashboard da Investidora *(Dashboard Investidor)*
- Interface muda para **roxo**.  
- Destaques: Rentabilidade e Lucro.  
- Cards de **Produtos ofertados ativos** levam para:  
  - Empr√©stimos Concedidos.  
  - Negocia√ß√µes de Ofertas (Investidor).  

### 2. A An√°lise e a Contraproposta ‚Äì O Core do Investidor
- **Passo 2a ‚Äì An√°lise (Detalhes da negocia√ß√£o)**  
  - Visualiza√ß√£o da proposta original + contraproposta do tomador.  
  - Diferen√ßa de valores + justificativa escrita.  
  - Perfil detalhado do tomador (Pontua√ß√£o, tempo de conta etc.).  

- **Passo 2b ‚Äì A√ß√£o (Contraproposta)**  
  - Caso n√£o aceite a proposta do tomador.  
  - Tela espelho da negocia√ß√£o do Tomador.  

### 3. A Antecipa√ß√£o de receb√≠veis

- **Passo 3a ‚Äì Acessar Empr√©stimo em Andamento**  
    - Lista de empr√©stimos concedidos com status detalhado.  
    - Selecionar um empr√©stimo para abrir a tela de detalhes e a√ß√µes dispon√≠veis.  

- **Passo 3b ‚Äì Simula√ß√£o de Antecipa√ß√£o de Parcelas**  
    - Op√ß√£o: "Antecipar parcelas" na tela do empr√©stimo.  
    - Escolha: selecionar n√∫mero X de parcelas a antecipar (controle por slider ou campo num√©rico) ou op√ß√£o "Antecipar todas".  
    - Bot√£o "Simular" gera pr√©-visualiza√ß√£o com:  
        - Parcelas selecionadas e soma do valor nominal.  
        - Taxa da antecipa√ß√£o: valor percentual proporcional √†s parcelas antecipadas que ser√° repassado para a institui√ß√£o financeira.  
        - Valor l√≠quido a ser recebido pelo investidor ap√≥s dedu√ß√£o da taxa.  
        - Impacto no retorno estimado. 
    - Exibir explica√ß√µes r√°pidas sobre como a taxa √© calculada (percentual sobre o valor antecipado).

- **Passo 3c ‚Äì Confirma√ß√£o da Antecipa√ß√£o**  
    - Tela com resumo detalhado (parcelas, valor bruto, taxa da antecipa√ß√£o, valor l√≠quido, impacto no portf√≥lio de empr√©stimos concedidos).  
    - Bot√£o "Confirmar Antecipa√ß√£o".  
    - Confirma√ß√£o da transa√ß√£o de antecipa√ß√£o na blockchain.

- **Passo 3d ‚Äì Sucesso e Registro**  
    - Mensagem de sucesso.
    - Notifica√ß√£o enviada ao investidor.  
    - Atualiza√ß√£o imediata no dashboard do investidor (saldo dispon√≠vel, novo fluxo de caixa, hist√≥rico da opera√ß√£o).  

### 4. Telas An√°logas
- Fluxo de cria√ß√£o de uma oferta *(Ofertar empr√©stimo 1-4 etc.)*.  
- Prototipado para mostrar consist√™ncia visual.  
- Fluxo completo seria an√°logo ao de *Solicitar Empr√©stimo* do Tomador.  

---

# Estrutura de Pastas do negocia.ai

```bash
src/
‚îî‚îÄ‚îÄ backend/
    ‚îî‚îÄ‚îÄ src/
        ‚îî‚îÄ‚îÄ app/
            ‚îú‚îÄ‚îÄ api/
            ‚îÇ   ‚îî‚îÄ‚îÄ routers.py
            ‚îú‚îÄ‚îÄ database/
            ‚îÇ   ‚îú‚îÄ‚îÄ create_database.sql
            ‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
            ‚îú‚îÄ‚îÄ models/
            ‚îÇ   ‚îú‚îÄ‚îÄ negociacao.py
            ‚îÇ   ‚îú‚îÄ‚îÄ proposta.py
            ‚îÇ   ‚îî‚îÄ‚îÄ usuario.py
            ‚îÇ   ‚îî‚îÄ‚îÄ score.py
            ‚îÇ   ‚îî‚îÄ‚îÄ metricas_investidor.py
            ‚îú‚îÄ‚îÄ services/
            ‚îÇ   ‚îú‚îÄ‚îÄ api_score.py
            ‚îÇ   ‚îú‚îÄ‚îÄ blockchain.py
            ‚îÇ   ‚îú‚îÄ‚îÄ calculo_taxas_juros.py
            ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.py
            ‚îÇ   ‚îú‚îÄ‚îÄ negociacao.py
            ‚îÇ   ‚îú‚îÄ‚îÄ bacen.py
            ‚îÇ   ‚îú‚îÄ‚îÄ proposta.py
            ‚îÇ   ‚îî‚îÄ‚îÄ usuario.py
            ‚îîmodel/
              ‚îî‚îÄ‚îÄ model_analise_credito.py
        ‚îú‚îÄ‚îÄ config.py
        ‚îú‚îÄ‚îÄ Dockerfile
        ‚îú‚îÄ‚îÄ requirements.txt
        ‚îî‚îÄ‚îÄ docker-compose.yml
    frontend/
    ‚îî‚îÄ‚îÄsrc/
          ‚îú‚îÄ‚îÄ assets/
          ‚îÇ   ‚îú‚îÄ‚îÄ fonts/
          ‚îÇ   ‚îî‚îÄ‚îÄ images/
          ‚îú‚îÄ‚îÄ components/
          ‚îÇ   ‚îú‚îÄ‚îÄ atoms/
          ‚îÇ   ‚îú‚îÄ‚îÄ molecules/
          ‚îÇ   ‚îî‚îÄ‚îÄ organisms/
          ‚îú‚îÄ‚îÄ contexts/
          ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx
          ‚îú‚îÄ‚îÄ hooks/
          ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
          ‚îÇ   ‚îî‚îÄ‚îÄ useNegotiations.ts
          ‚îú‚îÄ‚îÄ navigation/
          ‚îÇ   ‚îú‚îÄ‚îÄ AppNavigator.tsx
          ‚îÇ   ‚îî‚îÄ‚îÄ AuthStack.tsx
          ‚îú‚îÄ‚îÄ screens/
          ‚îÇ   ‚îú‚îÄ‚îÄ Auth/
          ‚îÇ   ‚îú‚îÄ‚îÄ Borrower/
          ‚îÇ   ‚îî‚îÄ‚îÄ Investor/
          ‚îú‚îÄ‚îÄ services/
          ‚îÇ   ‚îî‚îÄ‚îÄ api.ts
          ‚îú‚îÄ‚îÄ styles/
          ‚îÇ   ‚îú‚îÄ‚îÄ colors.ts
          ‚îÇ   ‚îú‚îÄ‚îÄ spacing.ts
          ‚îÇ   ‚îî‚îÄ‚îÄ typography.ts
          ‚îú‚îÄ‚îÄ types/
          ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
          ‚îî‚îÄ‚îÄ utils/
              ‚îî‚îÄ‚îÄ formatters.ts
    bash
.env
README.md
```

## üìÇ src/backend/src

C√≥digo-fonte principal da aplica√ß√£o backend, organizado por camadas (API, database, models, services, ML).

### üìÇ app/api
- **routers.py**  
  Define as rotas da API (endpoints HTTP) do FastAPI.  
  Centraliza a orquestra√ß√£o dos servi√ßos e exp√µe as funcionalidades para o front-end/mobile.

### üìÇ app/database
- **create_database.sql**  
  Script SQL inicial para cria√ß√£o das tabelas e rela√ß√µes do banco de dados (Postgres).  
- **Dockerfile**  
  Dockerfile espec√≠fico para configurar a imagem do banco local (quando usado com `docker-compose`).

### üìÇ app/models
Cont√©m os modelos (entidades) que representam as tabelas do banco e objetos de neg√≥cio.  
- **negociacao.py** ‚Äì Modelo da negocia√ß√£o entre tomador e investidor.  
- **proposta.py** ‚Äì Modelo das propostas e contrapropostas.  
- **usuario.py** ‚Äì Modelo dos usu√°rios, incluindo dados cadastrais.  
- **score.py** ‚Äì Modelo das an√°lises de score de cr√©dito. 
- **metricas_investidor.py** ‚Äì Modelo das m√©tricas do investidor.

### üìÇ app/services
Servi√ßos e regras de neg√≥cio que d√£o suporte √†s rotas.  
- **api_score.py** ‚Äì Servi√ßo respons√°vel pela consulta/integra√ß√£o com API de score de cr√©dito (integrada ao Serasa).  
- **blockchain.py** ‚Äì Servi√ßo para intera√ß√£o com a blockchain Polkadot (registro de contratos e leitura de hashes).  
- **calculo_taxas_juros.py** ‚Äì Fun√ß√µes auxiliares para c√°lculo de taxas e juros dos empr√©stimos.
- **bacen.py** ‚Äì Servi√ßo para integra√ß√£o com API's oficiais do Banco Central, para comunica√ß√µes das transa√ß√µes.
- **dashboard.py** ‚Äì Servi√ßo para agrega√ß√£o e c√°lculo de m√©tricas exibidas nas dashboards dos usu√°rios.  
- **negociacao.py** ‚Äì L√≥gica de neg√≥cio das negocia√ß√µes (cria√ß√£o, atualiza√ß√£o de status).  
- **proposta.py** ‚Äì L√≥gica de envio/valida√ß√£o de propostas e contrapropostas.  
- **usuario.py** ‚Äì Servi√ßo para cadastro, login e gest√£o de dados de usu√°rios.  

### üìÇ model
- **model_analise_credito.py**  
  Implementa√ß√£o de modelo de an√°lise de cr√©dito (atrav√©s de machine learning).  
  Utilizado para classifica√ß√£o de risco de tomadores de empr√©stimo.

---

## ‚öôÔ∏è Arquivos de Configura√ß√£o

- **config.py**  
  Configura√ß√µes globais do backend (chaves de API, conex√µes de banco, par√¢metros de blockchain).  

- **Dockerfiles**  
  Dockerfile para empacotar e rodar o backend no ECS Fargate (ou localmente), e outro para a constru√ß√£o da imagem do banco Postgres para testes locais, configurado de maneira an√°loga √† inst√¢ncia RDS (AWS) em produ√ß√£o.  

- **requirements.txt**  
  Lista de depend√™ncias Python (FastAPI, Web3.py, scikit-learn, entre demais utilit√°rios do aplicativo).  

- **docker-compose.yml**  
  Orquestra√ß√£o de containers para desenvolvimento local (ex.: Postgres + backend).  

- **.env**  
  Vari√°veis de ambiente sens√≠veis (senhas, tokens, chaves de API).  

- **README.md**  
  Documenta√ß√£o inicial do projeto, instru√ß√µes de setup e guia r√°pido.  


- Vis√£o geral da arquitetura (monolito, microservi√ßos, serverless, etc.)
- Componentes principais
- Fluxo de dados entre front-end, backend e blockchain
- Integra√ß√µes externas (ex.: APIs, parceiros)

## üìÇ src/frontend/src

C√≥digo-fonte principal da aplica√ß√£o mobile em React Native, organizado por funcionalidade e responsabilidade para garantir escalabilidade e manutenibilidade.

### üìÇ assets
Recursos est√°ticos da aplica√ß√£o.

- **fonts/** ‚Äì Arquivos de fontes customizadas (ex: `Inter-Regular.ttf`, `Inter-Bold.ttf`).  
- **images/** ‚Äì Imagens e √≠cones est√°ticos (ex: logo, √≠cone do trevo do estado vazio).  

### üìÇ components
Componentes de UI reutiliz√°veis, organizados seguindo uma abordagem inspirada no Atomic Design.

- **atoms/** ‚Äì Os menores componentes poss√≠veis, como `Button.tsx`, `Input.tsx`, `ScoreRing.tsx`. Eles s√£o os blocos de constru√ß√£o da UI.  
- **molecules/** ‚Äì Combina√ß√µes de √°tomos para formar componentes mais complexos, como `SearchBar.tsx` ou `LoanOfferCard.tsx`.  
- **organisms/** ‚Äì Se√ß√µes maiores da interface compostas por mol√©culas e/ou √°tomos, como `Header.tsx` ou `LoanList.tsx`.  

### üìÇ contexts
Gerenciamento de estado global com a Context API do React.  

- **AuthContext.tsx** ‚Äì Contexto para gerenciar o estado de autentica√ß√£o do usu√°rio (token, dados do usu√°rio logado).  

### üìÇ hooks
Hooks customizados que encapsulam l√≥gicas de neg√≥cio e intera√ß√µes com servi√ßos.

- **useAuth.ts** ‚Äì Hook para interagir com o `AuthContext`, provendo fun√ß√µes como `signIn`, `signOut`, `signUp`.  
- **useNegotiations.ts** ‚Äì Hook para buscar, criar e atualizar o estado das negocia√ß√µes de um usu√°rio.  

### üìÇ navigation
Configura√ß√£o da navega√ß√£o do app usando React Navigation.

- **AuthStack.tsx** ‚Äì Navegador do tipo *Stack* para o fluxo de autentica√ß√£o (Login, Cadastro, Sele√ß√£o de Perfil).  
- **AppNavigator.tsx** ‚Äì Navegador principal que controla a navega√ß√£o p√≥s-login, incluindo o *Tab Navigator* ou *Drawer*.  

### üìÇ screens
Cont√©m as telas completas da aplica√ß√£o, organizadas por fluxo.  

- **Auth/** ‚Äì Telas de `LoginScreen.tsx`, `SignUpScreen.tsx`, `ProfileSelectionScreen.tsx`.  
- **Borrower/** ‚Äì Telas do fluxo do Tomador: `DashboardScreen.tsx`, `OfferDetailsScreen.tsx`, `NegotiationScreen.tsx`, etc.  
- **Investor/** ‚Äì Telas do fluxo do Investidor: `DashboardScreen.tsx`, `SolicitationDetailsScreen.tsx`, `CounterProposalScreen.tsx`, etc.  

### üìÇ services
Camada respons√°vel pela comunica√ß√£o com APIs externas, principalmente o backend.  

- **api.ts** ‚Äì Configura√ß√£o da inst√¢ncia do Axios (ou outra lib HTTP), com URL base e interceptors.  

### üìÇ styles (ou theme)
Defini√ß√£o do Design System em c√≥digo.  

- **colors.ts** ‚Äì Exporta a paleta de cores (ex: `primaryBlue`, `investorPurple`, `warningYellow`).  
- **spacing.ts** ‚Äì Exporta tokens de espa√ßamento (ex: `spacing.md = 16`).  
- **typography.ts** ‚Äì Exporta estilos de fonte (ex: `H1`, `H2`, `Body`).  

### üìÇ types
Defini√ß√µes de tipos e interfaces TypeScript para garantir tipagem.  

- **index.ts** ‚Äì Exporta tipos como `User`, `LoanOffer`, `Negotiation`.  

### üìÇ utils
Fun√ß√µes auxiliares e utilit√°rias puras.  

- **formatters.ts** ‚Äì Fun√ß√µes para formatar valores, como `formatCurrency(10000)` ‚Üí `"R$10.000,00"`.  

## üõ†Ô∏è **Requisitos Funcionais**

| ID    | Descri√ß√£o                                                                                                                                                                                                                                                | Prioridade |
|-------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| RF001 | **Cadastro e Onboarding de Usu√°rios**<br>O sistema deve permitir que novos usu√°rios (tomadores e investidores) se cadastrem fornecendo dados pessoais e documentos.                                                                                          | Alta       |
| RF002 | **Valida√ß√£o de Cadastro e Antifraude**<br>O sistema deve realizar o cadastro seguro de usu√°rios atrav√©s da valida√ß√£o de documentos, classifica√ß√£o de perfil e verifica√ß√£o antifraude.                                 | Alta       |
| RF003 | **C√°lculo/Aquisi√ß√£o de Score de Cr√©dito**<br>O sistema deve calcular um score de cr√©dito interno baseado em modelos de automa√ß√£o com intelig√™ncia artificial pr√≥prios e, em caso de dados insuficientes de usu√°rios novos, consultar a API do Serasa.         | Alta       |
| RF004 | **Gerenciamento de Perfil de Risco**<br>O sistema deve manter um perfil de risco atualizado para cada usu√°rio, baseado no score, hist√≥rico de empr√©stimos, dados de smart contracts e Open Finance (planos futuros).                                   | M√©dia      |
| RF005 | **Solicita√ß√£o de Empr√©stimo**<br>O tomador deve poder solicitar um empr√©stimo informando o valor desejado, prazo e finalidade.                                                                                                                               | Alta       |
| RF006 | **Dashboard de Propostas de Empr√©stimo (Investidor)**<br>O sistema deve exibir para o investidor uma lista de empr√©stimos solicitados, com as taxas e juros sugeridos pelo tomador, juntamente com recomenda√ß√µes baseadas no perfil de risco do tomador.      | Alta       |
| RF007 | **Negocia√ß√£o de Taxas e Juros**<br>O investidor deve poder fazer uma proposta de taxa e juros diferente da sugerida pelo tomador. O tomador deve poder aceitar, recusar ou fazer uma contraproposta.                                                         | Alta       |
| RF008 | **Hist√≥rico de Negocia√ß√µes**<br>O sistema deve armazenar o hist√≥rico completo de todas as propostas e contrapropostas realizadas para cada solicita√ß√£o de empr√©stimo.                                                                                        | M√©dia      |
| RF009 | **Hist√≥rico de Empr√©stimos**<br>O sistema deve manter um hist√≥rico completo de todos os empr√©stimos de um usu√°rio, incluindo valor, taxas acordadas, tempo de vig√™ncia, status e dados do smart contract.                                                    | Alta       |
| RF010 | **Dashboard de Performance (Investidor)**<br>O sistema deve fornecer ao investidor um dashboard com m√©tricas de performance de sua carteira (ex: retorno total, taxa de inadimpl√™ncia, diversifica√ß√£o).                                                     | Alta       |
| RF011 | **Recomenda√ß√µes de Diversifica√ß√£o**<br>O sistema deve recomendar ao investidor oportunidades de diversifica√ß√£o de sua carteira, tanto em tipos de empr√©stimo quanto em perfis de tomadores.                                                                  | Baixa      |
| RF012 | **Integra√ß√£o com Open Finance (Futuro)**<br>O sistema deve ser preparado para uma futura integra√ß√£o com o Open Finance para enriquecer a an√°lise de perfil com dados transacionais reais.                                                                    | Baixa      |
| RF013 | **Navega√ß√£o entre Funcionalidades**<br>O sistema deve permitir que o usu√°rio navegue entre funcionalidades como investidor ou tomador de empr√©stimos.                                                                                                        | Alta       |
| RF014 | **C√°lculo de Margens de Taxas/Juros por Risco**<br>O sistema deve ser capaz de realizar c√°lculos de margens das taxas/juros por risco comumente aceitas nas negocia√ß√µes da plataforma, auxiliando tomadores e investidores no sucesso das negocia√ß√µes.        | Alta       |
| RF015 | **Antecipa√ß√£o de Receb√≠veis de Parcelas**<br>O sistema deve possibilitar que o investidor antecipe receb√≠veis de parcelas, permitindo solicitar o adiantamento dos valores a receber antes do vencimento, mediante desconto e liquida√ß√£o via institui√ß√£o financeira parceira integrada √† plataforma. | Alta |
| RF016 | **Registro de a√ß√µes na Blockchain**<br>O sistema deve garantir que toda opera√ß√£o de registro de empr√©stimos entre usu√°rios, bem como antecipa√ß√£o de receb√≠veis realizada pelo investidor, sejam registradas na blockchain Polkadot, gerando um hash p√∫blico do contrato e do evento de antecipa√ß√£o para garantir transpar√™ncia, rastreabilidade e seguran√ßa jur√≠dica. | Alta |
---

## ‚ú® **Requisitos N√£o Funcionais**

| ID     | Categoria    | Descri√ß√£o                                                                                                                                                                                                                                         |
|--------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RNF001 | Seguran√ßa    | O sistema deve seguir as melhores pr√°ticas de seguran√ßa (OWASP), com todos os dados sens√≠veis criptografados em tr√¢nsito e em repouso.                                                                                                            |
| RNF002 | Desempenho   | As p√°ginas principais (login, dashboard) devem carregar em menos de 5 segundos em uma conex√£o de 3G. Para dados de menor volatilidade, as APIs devem responder em at√© 2 segundos para 95% das requisi√ß√µes, utilizando armazenamento local para otimiza√ß√£o das entregas. |
| RNF004 | Usabilidade  | A interface deve ser intuitiva, seguindo princ√≠pios de UX/UI, e responsiva, funcionando adequadamente em dispositivos desktop e m√≥veis.                                                                                                            |
| RNF005 | Confiabilidade | As transa√ß√µes financeiras e a execu√ß√£o dos smart contracts devem ser at√¥micas (n√£o podem falhar parcialmente) e garantir a consist√™ncia dos dados.                                                                                              |
| RNF006 | Escalabilidade | A arquitetura do sistema deve incluir sistema de filas para ser capaz de organizar as requisi√ß√µes e escalar horizontalmente, suportando um aumento de 10x no n√∫mero de usu√°rios sem degrada√ß√£o cr√≠tica do desempenho.                           |
| RNF009 | Acessibilidade e Daltonismo | O sistema deve ser acess√≠vel a pessoas com defici√™ncia, incluindo suporte a leitores de tela, navega√ß√£o por teclado e contraste adequado de cores para usu√°rios dalt√¥nicos. Todas as interfaces devem seguir as diretrizes WCAG 2.1 e garantir que informa√ß√µes essenciais n√£o dependam exclusivamente de cor. | Alta |                                   |

### Requisitos como User Stories

Esta subse√ß√£o apresenta os requisitos do projeto sob a forma de User Stories, facilitando o entendimento das necessidades reais do p√∫blico alvo da nossa solu√ß√£o.

### User Stories ‚Äî Requisitos Funcionais

#### 1. Cadastro e onboarding de usu√°rios

- **Como usu√°rio**, quero me cadastrar informando meus dados pessoais e documentos para que eu possa acessar a plataforma.
- **Como administrador**, quero que o sistema valide os dados do cadastro para evitar usu√°rios falsos.

---

#### 2. Valida√ß√£o de cadastro e antifraude

- **Como usu√°rio**, quero que meus documentos sejam verificados automaticamente para que eu tenha mais seguran√ßa no processo de cadastro.
- **Como administrador**, quero garantir que perfis fraudulentos sejam bloqueados.

---

#### 3. C√°lculo e aquisi√ß√£o de score de cr√©dito

- **Como investidor**, quero consultar o score de cr√©dito de um tomador para decidir se vou investir nele.
- **Como tomador**, quero que o sistema busque meu score do Serasa quando n√£o houver hist√≥rico interno, para que eu possa solicitar cr√©dito.

---

#### 4. Gerenciamento de perfil de risco

- **Como investidor**, quero acessar um perfil de risco consolidado de cada tomador para entender o risco antes de emprestar.
- **Como administrador**, quero que o sistema atualize perfis de risco dinamicamente a partir de score, hist√≥rico de empr√©stimos e dados do Open Finance (quando dispon√≠vel).

---

#### 5. Solicita√ß√£o de empr√©stimo

- **Como tomador**, quero solicitar um empr√©stimo informando valor, prazo, taxas e juros para obter recursos de forma r√°pida.

---

#### 6. Dashboard de propostas de empr√©stimo (investidor)

- **Como investidor**, quero visualizar todos os pedidos de empr√©stimos ativos com informa√ß√µes de score e taxas sugeridas para escolher onde investir.
- **Como investidor**, quero receber recomenda√ß√µes de empr√©stimos alinhados ao meu perfil de risco.

---

#### 7. Negocia√ß√£o de taxas e juros

- **Como investidor**, quero fazer uma proposta de taxa diferente da sugerida para tentar obter melhores condi√ß√µes.
- **Como tomador**, quero visualizar as contrapropostas de investidores e decidir se aceito, recuso ou fa√ßo outra contraproposta.

---

#### 8. Hist√≥rico de negocia√ß√µes

- **Como usu√°rio (investidor ou tomador)**, quero acessar o hist√≥rico de todas as propostas e contrapropostas de um empr√©stimo para acompanhar a negocia√ß√£o.

---

#### 9. Hist√≥rico de empr√©stimos

- **Como usu√°rio**, quero acessar meu hist√≥rico de empr√©stimos com informa√ß√µes sobre valores, prazos, taxas e status.

---

#### 10. Dashboard de performance (investidor)

- **Como investidor**, quero visualizar m√©tricas de performance da minha carteira (retorno total, taxa de inadimpl√™ncia, diversifica√ß√£o) para acompanhar meus resultados.

---

#### 11. Recomenda√ß√µes de diversifica√ß√£o

- **Como investidor**, quero receber sugest√µes de diversifica√ß√£o de carteira para reduzir riscos e equilibrar meu portf√≥lio.

---

#### 12. Integra√ß√£o com Open Finance (futuro)

- **Como administrador**, quero que o sistema esteja preparado para integrar dados do Open Finance no futuro para enriquecer os perfis de risco.

---

#### 13. Navega√ß√£o entre funcionalidades

- **Como usu√°rio**, quero poder alternar entre a aba de tomador e a aba de investidor para usar a plataforma tanto para pegar quanto para emprestar dinheiro.
- **Como sistema**, quero que o dashboard permita alternar entre as vis√µes de ‚Äúinvestidor‚Äù e ‚Äútomador‚Äù de forma fluida, garantindo consist√™ncia nos dados apresentados.

---

#### 14. C√°lculo de sugest√µes de taxas/juros

- **Como usu√°rio tomador ou investidor**, quero poder visualizar recomenda√ß√µes de taxas/juros mais aceitos dentre os usu√°rios da plataforma, para aumentar as minhas chances de sucesso de ofertas e contrapropostas.
- **Como sistema**, nas visualiza√ß√µes de oferta, proposta ou contraproposta, quero que seja mostrado ao usu√°rio frases de recomenda√ß√µes de taxas e juros, garantindo mecanismos de melhoria de negocia√ß√µes.

#### 15. Antecipa√ß√£o de receb√≠veis de parcelas

- **Como investidor**, quero antecipar o recebimento de parcelas de empr√©stimos concedidos, recebendo o valor antes do vencimento mediante desconto, para aumentar minha liquidez.
- **Como sistema**, quero registrar e liquidar a antecipa√ß√£o via institui√ß√£o financeira parceira, atualizando o fluxo de caixa do investidor e o hist√≥rico da opera√ß√£o.

---

#### 16. Registro de a√ß√µes na blockchain

- **Como usu√°rio**, quero que cada opera√ß√£o relevante (empr√©stimo, antecipa√ß√£o de receb√≠veis) seja registrada na blockchain Polkadot, gerando um hash p√∫blico para garantir transpar√™ncia e seguran√ßa jur√≠dica.
- **Como administrador**, quero que o sistema registre e audite todos os contratos e eventos cr√≠ticos na blockchain, facilitando a rastreabilidade e conformidade regulat√≥ria.

---

### User Stories ‚Äî Requisitos N√£o Funcionais

#### Seguran√ßa

- **Como usu√°rio**, quero que meus dados sejam criptografados em tr√¢nsito e em repouso para garantir privacidade.
- **Como administrador**, quero que o sistema siga pr√°ticas OWASP para mitigar ataques.

---

#### Desempenho

- **Como usu√°rio**, quero que o login e o dashboard carreguem em at√© 5 segundos mesmo em redes lentas para n√£o perder tempo.
- **Como usu√°rio**, quero que as respostas da API sejam r√°pidas para ter fluidez na navega√ß√£o.

---

#### Usabilidade

- **Como usu√°rio**, quero que a interface seja intuitiva e responsiva para usar facilmente no celular e no computador.

---

#### Confiabilidade

- **Como usu√°rio**, quero que as transa√ß√µes financeiras sejam at√¥micas e consistentes para n√£o perder dinheiro em caso de falhas.

---

#### Escalabilidade

- **Como administrador**, quero que o sistema consiga suportar 10x mais usu√°rios sem degrada√ß√£o de performance para acompanhar o crescimento.

---
#### Integra√ß√£o

- **Como sistema**, quero ter mecanismos de retry e fallback em APIs externas para n√£o prejudicar o usu√°rio em caso de indisponibilidade.

---

#### Conformidade

- **Como usu√°rio**, quero que o sistema esteja em conformidade com a LGPD para que meus dados pessoais sejam tratados corretamente.

---

#### Acessibilidade e Daltonismo

- **Como usu√°rio com defici√™ncia**, quero que a plataforma seja acess√≠vel, incluindo suporte a leitores de tela, navega√ß√£o por teclado e contraste adequado de cores, para que eu possa utilizar todas as funcionalidades sem barreiras.
- **Como usu√°rio dalt√¥nico**, quero que as informa√ß√µes essenciais n√£o dependam exclusivamente de cor, garantindo que eu compreenda e navegue pela interface sem dificuldades.
- **Como administrador**, quero que o sistema siga as diretrizes WCAG 2.1 para garantir acessibilidade e inclus√£o de todos os usu√°rios.


---

## üèõÔ∏è Modelagem de dados e arquitetura

### Diagrama de Componentes

<div align="center">
<sub>Figura 1 - Diagrama de componentes + Cloud</sub><br>
<br>
<img src="./img/componentes.png" alt='Diagrama de componentes + Cloud' width="80%">
<br>
<br>
<sup>Fonte: Material produzido pelos autores (2025)</sup>
</div>
<br>

A arquitetura do aplicativo mobile negocia.ai foi desenhada para modularizar as principais partes da solu√ß√£o em componentes independentes, facilitando manuten√ß√£o, escalabilidade e integra√ß√£o cont√≠nua. Os tr√™s componentes centrais s√£o: banco de dados relacional, backend de servi√ßos e frontend mobile.

### Banco de Dados

<div align="center">
<sub>Figura 2 - Modelagem l√≥gica do banco de dados</sub><br>
<br>
<img src="./img/banco.png" alt='Modelagem l√≥gica do banco de dados' width="80%">
<br>
<br>
<sup>Fonte: Material produzido pelos autores (2025)</sup>
</div>
<br>

O banco de dados relacional utiliza PostgreSQL, encapsulado em uma imagem Docker para padroniza√ß√£o do ambiente de desenvolvimento e produ√ß√£o. Ele armazena informa√ß√µes em cinco tabelas principais:

- **usu√°rios**: dados cadastrais, valida√ß√£o e perfil.
- **negocia√ß√µes**: registros de negocia√ß√µes entre tomadores e investidores.
- **propostas**: termos de empr√©stimo, taxas, prazos, status e justificativas.
- **scores de cr√©dito**: resultados da an√°lise de cr√©dito, integrando machine learning e API Serasa.
- **m√©tricas do investidor**: dados de performance dos investimentos ofertados.
- **empr√©stimos**: armazena os registros de empr√©stimos oficializados, incluindo valor, taxa, prazo, partes envolvidas e status atual (em andamento, quitado, inadimplente, antecipado). Essa tabela √© fundamental para rastrear o ciclo de vida dos empr√©stimos, registrar pagamentos, liquida√ß√µes antecipadas e garantir a integridade dos dados para relat√≥rios, auditoria e integra√ß√£o com a blockchain e o Banco Central.

Os relacionamentos seguem as seguintes cardinalidades:

- Um usu√°rio possui um score de cr√©dito (1:1).
- Um usu√°rio pode participar de v√°rias negocia√ß√µes; cada negocia√ß√£o envolve dois usu√°rios (N:N), intermediada pela tabela de propostas.
- Um usu√°rio possui um registro √∫nico de m√©tricas de investidor (1:1).
- Um usu√°rio possui 0 ou mais empr√©stimos, enquanto 1 empr√©stimo √© associado a dois usu√°rios (0:N).

O banco √© executado localmente via Docker e, em produ√ß√£o, √© provisionado em uma inst√¢ncia RDS (AWS), garantindo escalabilidade, seguran√ßa e alta disponibilidade.

### Backend

O backend √© desenvolvido em Python, utilizando frameworks como FastAPI para APIs REST e integra√ß√£o com servi√ßos externos (ex.: Serasa, Blockchain). Ele √© containerizado e executado em AWS ECS Fargate, eliminando a necessidade de gerenciamento manual de servidores.

Principais servi√ßos implementados:

- Gerenciamento de usu√°rios (cria√ß√£o, valida√ß√£o, autentica√ß√£o).
- Fluxos de negocia√ß√µes e propostas de empr√©stimo.
- Visualiza√ß√£o de m√©tricas de performance para investidores.
- C√°lculo de score de cr√©dito, integrando machine learning e API Serasa.
- Filtragem de ofertas e condi√ß√µes de empr√©stimo por perfil de risco.
- Registro de contratos de empr√©stimo na Blockchain Polkadot.

A orquestra√ß√£o dos servi√ßos √© feita via containers, com deploy automatizado e escal√°vel.

### Frontend

O frontend √© desenvolvido em React, garantindo experi√™ncia nativa em dispositivos web e integra√ß√£o direta com as APIs do backend. A escolha do React se d√° pela alta produtividade, comunidade ativa e facilidade de manuten√ß√£o multiplataforma. Como principais funcionalidades, tem-se:

<p align="center">
<sub>Figura 3 - Feature de Negocia√ß√£o</sub><br>
  <img src="img/tela01.png" alt="Feature de Negocia√ß√£o" width="60%">
</p>

<p align="center">
<sub>Figura 4 - Feature de Dashboards</sub><br>
  <img src="img/tela02.png" alt="Feature de Dashboards" width="60%">
</p>

<p align="center">
<sub>Figura 5 - Feature de Vis√£o Geral de Oferta</sub><br>
  <img src="img/tela03.png" alt="Recursos de Vis√£o Geral de Oferta" width="60%">
</p>

<p align="center">
<sub>Figura 6 - Feature de Antecipa√ß√£o de Receb√≠veis</sub><br>
  <img src="img/tela04.png" alt="Configura√ß√£o de acessibilidade" width="60%">
</p>

### Acessibilidade

**Acessibilidade:** O sistema foi projetado para ser acess√≠vel a pessoas com defici√™ncia visual, incluindo suporte a leitores de tela, navega√ß√£o por teclado e uso de elementos sem√¢nticos. Para usu√°rios dalt√¥nicos, todas as interfaces seguem diretrizes WCAG 2.1, garantindo contraste adequado e que informa√ß√µes essenciais n√£o dependam exclusivamente de cor. Isso assegura que todos os usu√°rios possam navegar e utilizar a plataforma com autonomia e seguran√ßa.

<p align="center">
<sub>Figura 7 - Recursos de acessibilidade</sub><br>
  <img src="img/acessibilidade.png" alt="Configura√ß√£o de acessibilidade" width="60%">
</p>

As principais funcionalidades de acessibilidade dispon√≠veis s√£o dispon√≠veis ao se clicar no bot√£o superior direito da tela, no s√≠mbolo de um olho:

### 1. Ajuste de Tamanho da Fonte
- **Normal, Grande e Muito Grande:** O usu√°rio pode escolher entre tr√™s tamanhos de fonte para facilitar a leitura, aumentando a legibilidade conforme sua necessidade.

### 2. Ajuste de Peso da Fonte
- **Normal ou Negrito:** Permite selecionar o peso da fonte, tornando o texto mais grosso para melhorar o contraste visual e facilitar a identifica√ß√£o de informa√ß√µes importantes.

### 3. Modo Dalt√¥nico
- **Perfis de Daltonismo:** A interface oferece modos espec√≠ficos para diferentes tipos de daltonismo:
  - **Protanopia:** Defici√™ncia de vermelho.
  - **Deuteranopia:** Defici√™ncia de verde.
  - **Tritanopia:** Defici√™ncia de azul.
- **Cores Adaptadas:** As cores da plataforma s√£o ajustadas para garantir contraste adequado e que informa√ß√µes essenciais n√£o dependam exclusivamente de cor.

### 4. Diretrizes de Acessibilidade
- **WCAG 2.1:** Todas as telas seguem as recomenda√ß√µes internacionais de acessibilidade, incluindo suporte a leitores de tela, navega√ß√£o por teclado e contraste m√≠nimo.
- **Mensagens e √çcones:** Informa√ß√µes importantes s√£o sempre acompanhadas de texto ou √≠cones, evitando depend√™ncia exclusiva de cor para transmitir significado.

### 5. Outras funcionalides

- *Teclado:* Bot√µes, di√°logos e menus recebem aria-label, role e estados focados (focus:ring, sr-only), garantindo navega√ß√£o sem mouse.
- *Conte√∫do de apoio:* √çcones do cabe√ßalho trazem labels textuais em m√∫ltiplos idiomas, refor√ßando compreens√£o visual e auditiva.
- *Contraste & tem√°tica:* Tailwind tokens e tema shadcn mant√™m contraste AA. Classes bg-primary/20, text-muted-foreground equilibram hierarquia.
- *Feedback imediato:* Toasts (components/ui/toast.tsx e use-toast.ts) sinalizam sucesso/erro; modais (HelpDialog, AccessibilityMenu) trazem explica√ß√µes contextualizadas.
- *Prefer√™ncias de acessibilidade:* AccessibilityMenu oferece ajustes de fonte, alto contraste e leitura guiada, persistindo escolhas do usu√°rio.

Essas configura√ß√µes podem ser acessadas facilmente pelo usu√°rio, permitindo personalizar a interface conforme suas necessidades e garantindo que todos possam utilizar a plataforma com autonomia e seguran√ßa.


## 5.1 Vis√£o Geral da Stack
- *Base tecnol√≥gica:* Vite + React 18 com TypeScript, estiliza√ß√£o via Tailwind CSS e componentes pr√©-constru√≠dos do shadcn/ui.
- *Gerenciamento de estado local:* Hooks e Context API (Auth, Profile, Notification), priorizando coes√£o por dom√≠nio.
- *Apoio visual:* √≠cones Lucide, tipagem rigorosa em src/types e utilit√°rios em src/lib para consist√™ncia de formata√ß√£o e regras de neg√≥cio.
- *Constru√ß√£o & build:* scripts npm (dev, build, preview) e integra√ß√£o com linting/formatadores definidos em eslint.config.js e Tailwind.

## 5.2 Organiza√ß√£o de Pastas

src/
‚îú‚îÄ app/              # Inicializa√ß√£o do React (AppProviders, AppRoutes)
‚îú‚îÄ assets/           # Imagens, √≠cones e recursos est√°ticos
‚îú‚îÄ components/
‚îÇ  ‚îú‚îÄ accessibility/ # Menus e recursos de inclus√£o (ex.: AccessibilityMenu)
‚îÇ  ‚îú‚îÄ common/        # Cabe√ßalhos, rodap√©s, menus compartilhados
‚îÇ  ‚îú‚îÄ help/          # Di√°logos de onboarding, ajuda contextual
‚îÇ  ‚îú‚îÄ notifications/ # Bell, toast e lista de avisos
‚îÇ  ‚îî‚îÄ ui/            # √Åtomos reutiliz√°veis (button, card, input, label, toast)
‚îú‚îÄ config/           # Configura√ß√µes globais (ex.: api.ts)
‚îú‚îÄ contexts/         # React Contexts (AuthContext, ProfileContext, NotificationContext)
‚îú‚îÄ hooks/            # Hooks customizados (ex.: useRealtimeNotifications)
‚îú‚îÄ layouts/          # Layouts de p√°gina (MainLayout)
‚îú‚îÄ lib/              # Fun√ß√µes utilit√°rias e helpers
‚îú‚îÄ locales/          # Cat√°logo de tradu√ß√µes (pt, en, es)
‚îú‚îÄ pages/            # P√°ginas segmentadas por dom√≠nio (auth, dashboard, market, negotiations, profile)
‚îú‚îÄ routes/           # Prote√ß√£o e defini√ß√£o de rotas (AppRoutes, ProtectedRoute)
‚îî‚îÄ services/         # Camada de comunica√ß√£o com backend (auth, negotiations, proposals, rates, score)


*Conven√ß√µes principais:*
- Estrutura orientada a dom√≠nio para facilitar evolu√ß√£o independente de fluxos (auth, negotiations etc.).
- Componentes visuais b√°sicos vivem em components/ui; pe√ßas compostas reaproveit√°veis migram para components/common.
- Responsabilidades de API ficam isoladas em services, sempre tipadas e encapsuladas em fun√ß√µes puras.

## 5.3 Componentiza√ß√£o
- **√Åtomos (components/ui):** implementam tokens de design (bot√µes, inputs, cards, labels, textarea, toast). Eles recebem classes utilit√°rias Tailwind e podem ser estendidos via className para manter consist√™ncia.
- *Componentes Compostos:* LanguageSwitcher, MobileMenu, Header, HelpDialog, AccessibilityMenu, NotificationBell interligam m√∫ltiplos √°tomos respeitando acessibilidade (aria labels, tooltips, estados focados).
- *Layouts:* MainLayout integra cabe√ßalho, navega√ß√£o lateral e conte√∫do principal, garantindo responsividade e breakpoints definidos pelo Tailwind.
- *P√°ginas:* Cada pasta em pages/ orquestra componentes e servi√ßos para entregar fluxos completos (ex.: pages/negotiations/NewNegotiationPage.tsx consome servi√ßos de negocia√ß√µes, contextos de usu√°rio e ui components).

## 5.4 Estado Compartilhado & Hooks
- AuthContext: centraliza sess√£o, persist√™ncia de token e disponibiliza m√©todos de login/logout.
- ProfileContext: controla perfil ativo (investidor/tomador), habilitando rotas e dashboards espec√≠ficos.
- NotificationContext: armazena notifica√ß√µes em tempo real, permite marcar uma ou todas como lidas e alimenta NotificationBell.
- Hooks customizados (hooks/useRealtimeNotifications.ts, hooks/useToast) encapsulam assinaturas e side effects, mantendo p√°ginas enxutas.

## 5.5 Comunica√ß√£o com APIs
- Arquivo config/api.ts define base URL, inst√¢ncia HTTP (axios/fetch) e interceptadores.
- services/*.ts exportam fun√ß√µes ass√≠ncronas por dom√≠nio (auth, proposals, negotiations, rates, score). Cada fun√ß√£o:
  - Recebe par√¢metros tipados;
  - Chama endpoint correspondente;
  - Normaliza a resposta para objetos consumidos pela UI.
- Tratamento de erros: fun√ß√µes propagam exce√ß√µes padronizadas, habilitando toasts e feedbacks consistentes no front.

## 5.6 Internacionaliza√ß√£o
- Biblioteca react-i18next configurada em AppProviders.tsx.
- Tradu√ß√µes agrupadas por l√≠ngua em locales/{pt,en,es}/common.json, mantendo chaves estruturadas (header.*, auth.*, dashboard.*, negotiations.*, help.*).
- LanguageSwitcher exp√µe seletor global desde telas de login/cadastro, atualizando i18n.language e persistindo prefer√™ncia.
- Testes de consist√™ncia: chave ausente aciona fallback visual e √© monitorada durante builds (npm run build).

## 5.8 Fluxos Principais da Interface
- **Onboarding & Autentica√ß√£o (pages/auth)**
  - LoginPage, RegisterPage, ProfilePage: suporte a troca de idioma, explica√ß√µes contextuais e valida√ß√µes inline.
  - ProtectedRoute protege √°reas privadas, redirecionando conforme sess√£o.
- *Dashboard*
  - pages/dashboard/DashboardPage.tsx agrega KPIs, gr√°ficos e alertas conforme perfil ativo.
  - Widgets reutilizam componentes card, button e gr√°ficos conectados ao score.
- **Mercado & Negocia√ß√µes (pages/market, pages/negotiations)**
  - Listagem de oportunidades, filtros por taxa/prazo e detec√ß√£o de match de perfil.
  - Fluxo de negocia√ß√£o inclui cria√ß√£o (NewNegotiationPage), detalhamento (NegotiationDetailsPage) e contrapropostas (CounterProposalPage) com feedback em tempo real.
- *Antecipa√ß√£o de Receb√≠veis*
  - Integrada ao dashboard do investidor, permitindo simula√ß√£o de liquidez, c√°lculos com services/rates.service.ts e confirma√ß√£o com toasts.
- **Perfil & Configura√ß√µes (pages/profile)**
  - Ajuste de dados, prefer√™ncias de notifica√ß√£o e seguran√ßa; integra ProfileContext e services/usuario.
- *Tutoriais e Ajuda*
  - OnboardingTutorial destaca funcionalidades chave; HelpDialog organiza FAQs, v√≠deos e suporte.

## 5.9 Boas Pr√°ticas de Desenvolvimento
- Componentes mant√™m tipagem expl√≠cita (React.FC<Props>) e evitam l√≥gica imperativa pesada dentro de JSX.
- Estilos seguem o padr√£o className com utilit√°rios Tailwind, reduzindo CSS isolado.
- Tradu√ß√µes novas exigem sincroniza√ß√£o entre pt, en e es para eliminar warnings.
- Cada fluxo possui feedbacks visuais em caso de erro (toasts) e carregamento (skeletons/spinners conforme necess√°rio).

## 5.10 Pr√≥ximos Passos Sugeridos
1. Adicionar testes de integra√ß√£o (Cypress/Playwright) para validar fluxos cr√≠ticos (login, negocia√ß√£o, antecipa√ß√£o).
2. Expandir cobertura de acessibilidade com testes automatizados (axe) nos principais componentes.
3. Documentar contratos de API em paralelo (OpenAPI) para garantir ader√™ncia entre frontend e backend.

---

## üß† Automa√ß√µes e modelos da solu√ß√£o: Motores de Decis√£o

### **1. Motor de Score**

#### 1) Objetivo

Calcular um **score final (0‚Äì1000)** que representa o risco de cr√©dito do usu√°rio como tomador combinando:

1.  **Fonte externa: Serasa** (para usu√°rios sem hist√≥rico ou com hist√≥rico curto na plataforma -> "**cold start**" e "**thin file**").
2.  **Fonte interna:** baseada em **modelo supervisionado**, que utiliza os dados do hist√≥rico operacional do usu√°rio na plataforma para estimar diretamente a **probabilidade de *default***. Essa probabilidade √© ent√£o convertida em um score cont√≠nuo de 0 a 1000, refinando a avalia√ß√£o de risco de cada tomador.

**Persistimos apenas:**

* `scores_credito.analise` (**JSON** com m√©tricas agregadas).
* `scores_credito.valor_score` (resultado final **0‚Äì1000**).

O rec√°lculo ocorre **1x ao dia (batch)** e tamb√©m **sob demanda via listener** ap√≥s atualizar `analise`.

#### 2) Escopo e Premissas

* O score **n√£o considera a√ß√µes como investidor** (emprestador); s√≥ como **tomador**.
* A an√°lise interna adota diretamente um **modelo supervisionado**, que utiliza r√≥tulos de inadimpl√™ncia e quita√ß√£o para treinar a previs√£o de risco. O modelo estima a **probabilidade de *default*** de cada tomador com base em seu hist√≥rico operacional e dados da plataforma, convertendo esse resultado em um score cont√≠nuo de **0 a 1000**. Dessa forma, a solu√ß√£o j√° nasce alinhada √†s pr√°ticas do mercado de cr√©dito e evolui em precis√£o conforme mais dados hist√≥ricos s√£o acumulados.

### **Fluxo Geral:**

<p align="center">
<sub>Figura 8 - Fluxo do motor de decis√£o</sub><br>
  <img src="docs/assets/fluxo_score.png" alt="Fluxo de Score" width="75%">
</p>


#### 3) Fontes de Dados

##### 3.1 Off-chain (Banco existente)

Tabelas principais j√° existentes:

* `usuarios`
* `emprestimos`
* `negociacoes`
* `propostas`
* `scores_credito` (usaremos apenas `analise` e `valor_score` + `atualizado_em`)
* `metricas_investidor` 

##### 3.2 Externa

* **API Serasa** (score externo para *cold start* e composi√ß√£o do score final).

#### 4) Especifica√ß√£o do `analise`

O `analise` consolida somente m√©tricas de tomador:

```json
{
  "tempo_na_plataforma_meses": 0,
  "emprestimos_contratados": 0,
  "emprestimos_quitados": 0,
  "emprestimos_inadimplentes": 0,
  "taxa_inadimplencia": 0.0,
  "media_taxa_juros_paga": 0.0,
  "media_prazo_contratado": 0,
  "renda_mensal": 0.0,
  "endividamento_estimado": 0.0,
  "propostas_realizadas": 0,
  "propostas_aceitas": 0,
  "media_tempo_negociacao_dias": 0.0
}
```

#### 5) Coleta dos Dados (exemplos de SELECTs)

**Importante:** todos os filtros abaixo consideram o usu√°rio como tomador (ex: `negociacoes.id_tomador = :user_id`).

* **tempo_na_plataforma_meses**

    ```sql
    SELECT EXTRACT(EPOCH FROM (NOW() - u.criado_em)) / 2629800.0 AS meses
    FROM usuarios u
    WHERE u.id = :user_id;
    ```

* **emprestimos_contratados** (negocia√ß√£o ‚Äúfechada‚Äù = `assinado_em IS NOT NULL`)

    ```sql
    SELECT COUNT(*) FROM negociacoes n
    WHERE n.id_tomador = :user_id
      AND n.assinado_em IS NOT NULL;
    ```

* **emprestimos_quitados**

    ```sql
    SELECT COUNT(*) FROM negociacoes n
    WHERE n.id_tomador = :user_id AND n.status = 'quitado';
    ```

* **emprestimos_inadimplentes**

    ```sql
    SELECT COUNT(*) FROM negociacoes n
    WHERE n.id_tomador = :user_id AND n.status = 'inadimplente';
    ```

* **taxa_inadimplencia**

    ```sql
    WITH base AS (
      SELECT COUNT(*)::float AS total
      FROM negociacoes n
      WHERE n.id_tomador = :user_id AND n.assinado_em IS NOT NULL
    ), inad AS (
      SELECT COUNT(*)::float AS qte
      FROM negociacoes n
      WHERE n.id_tomador = :user_id AND n.status = 'inadimplente'
    )
    SELECT CASE WHEN base.total = 0 THEN 0 ELSE (inad.qte / base.total) END AS taxa
    FROM base, inad;
    ```

* **media_taxa_juros_paga / media_prazo_contratado** (assumindo proposta ‚Äúaceita‚Äù referencia os termos finais)

    ```sql
    SELECT AVG(p.taxa_juros_am) AS media_taxa,
          AVG(p.prazo_meses)   AS media_prazo
    FROM propostas p
    JOIN negociacoes n ON n.id = p.id_negociacoes
    WHERE n.id_tomador = :user_id
      AND n.assinado_em IS NOT NULL
      AND p.status = 'aceita';
    ```

* **renda_mensal**

    ```sql
    SELECT COALESCE(u.renda_mensal, 0) FROM usuarios u WHERE u.id = :user_id;
    ```

* **endividamento_estimado** (aprox.: soma valores aceitos e ainda vigentes $\div$ renda)

    ```sql
    WITH renda AS (
      SELECT COALESCE(u.renda_mensal, 0) AS renda FROM usuarios u WHERE u.id = :user_id
    ),
    divida AS (
      SELECT COALESCE(SUM(p.valor), 0) AS aberto
      FROM propostas p
      JOIN negociacoes n ON n.id = p.id_negociacoes
      WHERE n.id_tomador = :user_id
        AND n.status IN ('em andamento')
        AND p.status = 'aceita'
    )
    SELECT CASE WHEN renda.renda = 0 THEN 0 ELSE (divida.aberto / renda.renda) END AS endividamento
    FROM renda, divida;
    ```

* **propostas_realizadas / propostas_aceitas** (como tomador)

    ```sql
    SELECT
      SUM(CASE WHEN p.autor_tipo = 'tomador' THEN 1 ELSE 0 END) AS propostas_realizadas,
      SUM(CASE WHEN p.autor_tipo = 'tomador' AND p.status = 'aceita' THEN 1 ELSE 0 END) AS propostas_aceitas
    FROM propostas p
    JOIN negociacoes n ON n.id = p.id_negociacoes
    WHERE n.id_tomador = :user_id;
    ```

* **media_tempo_negociacao_dias** (da 1¬™ proposta do tomador at√© `assinado_em`)

    ```sql
    WITH first_prop AS (
      SELECT MIN(p.criado_em) AS primeira_data
      FROM propostas p
      JOIN negociacoes n ON n.id = p.id_negociacoes
      WHERE n.id_tomador = :user_id
        AND p.autor_tipo = 'tomador'
    ),
    assinada AS (
      SELECT AVG(EXTRACT(EPOCH FROM (n.assinado_em - fp.primeira_data)) / 86400.0) AS media_dias
      FROM negociacoes n CROSS JOIN first_prop fp
      WHERE n.id_tomador = :user_id
        AND n.assinado_em IS NOT NULL
        AND fp.primeira_data IS NOT NULL
    )
    SELECT COALESCE(media_dias, 0.0) FROM assinada;
    ```

Esses `SELECTs` s√£o executados pelo **Score Service** para montar o `analise`.

#### 6) Modelo Interno (Supervisionado)

##### 6.1 Abordagem para Score Interno

* **Por qu√™?** A solu√ß√£o de an√°lise de cr√©dito precisa gerar um score cont√≠nuo (0‚Äì1000) que reflita a probabilidade real de inadimpl√™ncia do tomador. Por isso, adotamos diretamente uma estrat√©gia **supervisionada**, alinhada √†s pr√°ticas consolidadas no mercado financeiro.
* **Abordagem Supervisionada:** Utilizamos dados do hist√≥rico operacional do usu√°rio na plataforma (`analise`), combinados com o status das negocia√ß√µes (**quitado vs. inadimplente**).
* O modelo adotado √© a **Logistic Regression**, por ser simples, explic√°vel e amplamente usada no mercado de cr√©dito. Esse ser√° o algoritmo de refer√™ncia para gera√ß√£o do score. Caso o volume e a complexidade dos dados aumentem significativamente, existe a possibilidade de migrar para modelos mais avan√ßados, como XGBoost ou LightGBM, mas apenas como evolu√ß√£o futura.
* Essa probabilidade de default (**PD**) √© ent√£o convertida em um score padronizado:
  ```
  score = round(1000 * (1 - prob_default))
  ```
* **Vantagens:** **Precis√£o**, **Escalabilidade** e **Alinhamento com mercado**.
* **Integra√ß√£o simples:** a sa√≠da √© um √∫nico valor cont√≠nuo (0‚Äì1000), armazenado em `valor_score`, enquanto os insumos ficam no campo `analise`.
* **Tecnologias:**
    * `scikit-learn` $\rightarrow$ **Logistic Regression**, baseline supervisionado.
    * `FastAPI` $\rightarrow$ expor o endpoint `/score`.
    * `SQLAlchemy` $\rightarrow$ coleta de dados.
    * **Batch di√°rio** $\rightarrow$ recalcula `analise` (features) e `valor_score` (score final).

##### 6.2 Pipeline do Modelo Interno

| Fase | Detalhes |
| :--- | :--- |
| **Extra√ß√£o** | Coletar o `analise` de todos os usu√°rios. Buscar r√≥tulos de cada negocia√ß√£o associada (`default` = 1 se inadimplente, 0 caso quitado/em dia). |
| **Prepara√ß√£o** | Convers√£o de tipos. **Imputa√ß√£o simples** (preencher valores ausentes com a mediana). **Normaliza√ß√£o** (`StandardScaler`). Divis√£o treino/teste: 80% treino, 20% teste, com estratifica√ß√£o. |
| **Treino** (semanal ou mensal) | Algoritmo oficial: **Logistic Regression**. O modelo aprende a prever a probabilidade de default (PD). Persist√™ncia: salvar `scaler` + `modelo` em `.joblib`. M√©tricas de avalia√ß√£o: AUC-ROC, KS Statistic. |
| **Infer√™ncia di√°ria** | Para cada usu√°rio ativo, coletar `analise` atualizado. Aplicar `scaler` + `modelo` treinado. Obter PD $\in [0,1]$. Converter em score interno 0‚Äì1000: $$\text{score}=\text{round}(1000\times(1-\text{PD}))$$ |

* **Exemplo:** Usu√°rio com PD = 0.25 $\rightarrow$ Score = 750.
* **Observa√ß√µes:** O pipeline √© determin√≠stico e audit√°vel. O c√°lculo di√°rio garante que mudan√ßas no comportamento do tomador sejam refletidas rapidamente.


#### 7) F√≥rmula do Score Final

**M√©dia simples** (configur√°vel por ENV; padr√£o 50/50):

```
final_score = round(0.5 * serasa_score + 0.5 * interno_score)
```

**Fallbacks:**

* Se Serasa indispon√≠vel $\rightarrow$ `final = interno_score`
* Se modelo interno indispon√≠vel $\rightarrow$ `final = serasa_score`

N√£o persistimos os intermedi√°rios; apenas `analise` e `valor_score` final.


#### 8) Orquestra√ß√£o (Batch di√°rio + Listener)

##### 8.1 Batch Di√°rio (02:00 America/Sao_Paulo)

1.  Para cada usu√°rio tomador ativo: Rodar `SELECTs` $\rightarrow$ montar `analise`.
2.  Atualizar `scores_credito.analise` (`UPDATE`).
3.  **Publicar evento** `score.analise.updated:{user_id}` (Redis Pub/Sub).

  **Score Worker (listener) consome evento:**
  
  * Busca `analise`.
  * Chama Serasa API (com **cache de 24h**).
  * Roda modelo interno (Logistic Regression).
  * Calcula `final_score` (0‚Äì1000).
  * Atualiza `scores_credito.valor_score` e `atualizado_em`.

##### 8.2 Listener (on demand)

Toda vez que a aplica√ß√£o fizer `UPDATE` em `scores_credito.analise`, publica o mesmo evento `score.analise.updated:{user_id}`. O fluxo do *worker* √© id√™ntico ao *batch*.

#### 9) Servi√ßo de An√°lise ‚Äî FastAPI

##### 9.1 Endpoints (privados, behind-auth)

* `POST /internal/analysis/recalculate/{user_id}`: Executa `SELECTs`, monta e salva `analise`, publica evento.
* `POST /internal/scores/recalculate/{user_id}`: For√ßa rec√°lculo completo (busca Serasa, roda modelo, salva `valor_score`).
* `POST /internal/scores/recalculate-batch`: Dispara batch di√°rio (com pagina√ß√£o).
* `GET /internal/scores/{user_id}`: Retorna `{ valor_score, atualizado_em }` (leitura do banco).
* `POST /internal/models/retrain`: Re-treina Logistic Regression (uso semanal/mensal).

##### 9.2 Stack e Opera√ß√£o

* **Stack:** FastAPI + Uvicorn, SQLAlchemy, Requests/HTTPX para Serasa, Redis (Pub/Sub).
* **Monitoramento:** Prometheus (`/metrics`) com dura√ß√£o de infer√™ncia e QPS.


#### 10) Integra√ß√£o Serasa

##### 10.1 Motivo de uso

* Atribuir score para usu√°rios novos sem hist√≥rico (**‚Äúcold start‚Äù**).
* Servir de componente externo complementar.

##### 10.2 Implementa√ß√£o

* Connector com **cache por 24h** (Redis) para reduzir custos e lat√™ncia.
* Circuit breaker + retry exponencial.

##### 10.3 Seguran√ßa & LGPD

* **N√£o persistir payload bruto** do Serasa.
* Armazenar apenas: `timestamp` de consulta e valor para composi√ß√£o (usado em mem√≥ria).


#### 11) Versionamento de Modelo e Reprodutibilidade

* `model_version`: string (ex.: `iforest-2025-09-27`).
* **Artefatos:** `scaler.joblib`, `model.joblib`.
* **Logs de infer√™ncia** incluem: `user_id`, `model_version`, `score_interno`, `serasa_used`, `final_score`, `latency_ms`.


#### 12) Observabilidade e Qualidade

* **M√©tricas:** porcentagem de usu√°rios com `final_score < 300`, mediana do score.
* **Sa√∫de:** taxas de erro Serasa, *cache hit ratio*.
* **Drift check:** monitorar varia√ß√£o de distribui√ß√£o dos *features* (KS-test simples em batch semanal).

#### 13) Resili√™ncia & Fallback

* Serasa indispon√≠vel $\rightarrow$ segue com interno.
* Modelo indispon√≠vel $\rightarrow$ segue com Serasa.
* Ambos indispon√≠veis $\rightarrow$ mant√©m √∫ltimo `valor_score` e loga incidente.

#### 14) Seguran√ßa

* Secrets via Vault/Secrets Manager.
* Conex√µes TLS, IP allowlist para Serasa.
* **Princ√≠pio do m√≠nimo privil√©gio** (somente SELECT/UPDATE nas colunas necess√°rias).


#### 15) Roadmap de Evolu√ß√£o (Modelo)

1.  **Fase 1:** Logistic Regression.
2.  **Fase 2:** Enriquecer features (sazonalidade, granularidade por parcela).
3.  **Fase 3:** Ensemble supervisionado (Logistic Regression + modelos de √°rvore, como XGBoost/LightGBM).

---

### üöÄ **2. Motor de Recomenda√ß√£o**

#### 1) Objetivo
Construir um mecanismo de recomenda√ß√£o que:
- **Para investidores**: sugira empr√©stimos que mantenham uma carteira diversificada (evitar concentra√ß√£o em apenas um perfil de risco).
- **Para tomadores**: sugira par√¢metros de taxa justos e alinhados tanto ao mercado quanto ao hist√≥rico do pr√≥prio usu√°rio.

A l√≥gica n√£o depende de Machine Learning neste est√°gio, mas de c√°lculos estat√≠sticos, filtros e regras de neg√≥cio. Isso garante simplicidade, interpretabilidade e performance, al√©m de atender diretamente √†s necessidades da solu√ß√£o.

#### 2) Escopo e Premissas
- **Investidores**:
  - Recebem recomenda√ß√µes de novos empr√©stimos no marketplace, baseadas em ranges de valor, taxa e prazo semelhantes aos j√° investidos, priorizando a diversifica√ß√£o da carteira.
  - Tamb√©m recebem sugest√µes de taxa de juros (`taxa_analisada`) quando desejam abrir uma nova proposta de investimento, combinando par√¢metros de mercado com seu hist√≥rico pessoal.
- **Tomadores**:
  - Recebem sugest√£o de taxa de juros (`taxa_analisada`) ao criar uma nova proposta de empr√©stimo, ajustada pela m√©dia de mercado e pelo hist√≥rico de propostas anteriores.
  - Tamb√©m recebem recomenda√ß√µes de solicita√ß√µes de empr√©stimos semelhantes √†s que j√° fizeram, organizadas por par√¢metros como prazo, valor e taxa.
- A recomenda√ß√£o n√£o substitui a decis√£o, apenas apoia com transpar√™ncia e mensagens claras no front.
- **Orquestra√ß√£o**:
  - **Sugest√£o de taxa (`taxa_analisada`)**:
    - **Investidores e Tomadores**: a sugest√£o √© calculada on-demand no front, no momento em que o usu√°rio informa valor + prazo de uma nova proposta.
    - O c√°lculo da taxa combina dados de mercado (faixa m√©dia por score) + hist√≥rico pessoal.
    - A `taxa_analisada` √© exibida em tela, podendo ser opcionalmente registrada em `analise_taxa` apenas para fins de auditoria/analytics.
  - **Recomenda√ß√µes de empr√©stimos (matching)**:
    - **Investidores**: listener recalcula recomenda√ß√µes sempre que um contrato novo √© assinado ou quando novas solicita√ß√µes entram no marketplace.
    - **Tomadores**: listener recalcula recomenda√ß√µes de solicita√ß√µes semelhantes sempre que o pr√≥prio usu√°rio cria/edita uma proposta ou quando h√° novas oportunidades no mercado.

### **Fluxo Geral**

<p align="center">
<sub>Figura 9 - Fluxo do motor de score</sub><br>
  <img src="docs/assets/fluxo_recomendacao.png" alt="Fluxo da Recomenda√ß√£o" width="75%">
</p>


#### 3) Fontes de Dados
##### 3.1 Off-chain (Banco existente)
- `usuarios` ‚Üí perfil do investidor/tomador.
- `negociacoes` ‚Üí hist√≥rico de contratos fechados.
- `propostas` ‚Üí taxas, prazos e condi√ß√µes aceitas.
- `scores_credito` ‚Üí score final do tomador.
- `metricas_investidor` ‚Üí consolida√ß√£o da carteira (diversifica√ß√£o, hist√≥rico).

##### 3.2 Derivados Internos (calculados a partir do banco)
- **Faixas de mercado**: valores agregados que representam a m√©dia/mediana das taxas praticadas por faixa de score.
- **Exemplo**:
  - Score 800‚Äì1000 ‚Üí 10‚Äì13% a.m.
  - Score 500‚Äì799 ‚Üí 14‚Äì18% a.m.
  - Score <500 ‚Üí acima de 20% a.m.
- Esses dados n√£o v√™m de um sistema externo, mas s√£o recalculados internamente em batch di√°rio e usados como insumo para sugerir a `taxa_analisada`.

#### 4) L√≥gica de Recomenda√ß√£o
##### 4.1 Recomenda√ß√£o de Empr√©stimos/Solicita√ß√µes
- **Objetivo**: sugerir oportunidades relevantes (para investir ou para solicitar) que se encaixam melhor no perfil do usu√°rio.
- **Passos**:
  1. Coletar hist√≥rico do usu√°rio (investimentos ou solicita√ß√µes anteriores):
     - Valor m√©dio.
     - Faixa de taxa mais recorrente.
     - Prazo m√©dio.
     - Score dos tomadores com quem j√° se relacionou.
  2. Montar um array de solicita√ß√µes/empr√©stimos ativos no marketplace que batem com esse padr√£o.
  3. Ordenar esse array pelo grau de compatibilidade com o perfil.
- **Exibi√ß√£o no front**:
  - **Tela inicial** ‚Üí mostrar apenas o primeiro item da lista (recomenda√ß√£o principal).
  - **Bot√£o ‚ÄúVer todos‚Äù** ‚Üí exibir todas as oportunidades dispon√≠veis, mas com as mais compat√≠veis no topo.

##### 4.2 Recomenda√ß√£o de Taxa (`taxa_analisada`)
- **Objetivo**: apoiar o usu√°rio ao definir a taxa de uma nova proposta, equilibrando o hist√≥rico pessoal com a m√©dia de mercado.
- **Passos**:
  1. **Usu√°rio decide abrir nova oferta/solicita√ß√£o**:
     - Depois de tentar encontrar op√ß√µes existentes no marketplace, o usu√°rio escolhe abrir uma proposta nova.
  2. **Sistema sugere `taxa_analisada`**:
     - O sistema calcula a taxa sugerida com base em:
       - M√©dia de mercado (faixa de taxa por categoria de score).
       - Hist√≥rico do usu√°rio (taxas praticadas em propostas semelhantes calculadas em tempo real a partir dos par√¢metros digitados na tela de ‚ÄúEncontrar ofertas/solicita√ß√µes‚Äù, quando o usu√°rio digita os dados de seu empr√©stimo ideal).
     - Essa taxa √© exibida junto de mensagens de contexto (ex.: justa, alta, agressiva).
  3. **Usu√°rio revisa e confirma**:
     - O usu√°rio pode aceitar a taxa sugerida ou definir outra.
     - Nesse momento ele tamb√©m revisa os demais par√¢metros (valor, prazo, perfil de risco aceito).
- **Exibi√ß√£o no front**:
  - Mostrar a taxa sugerida.
  - Mostrar mensagens de contexto, como:
    - ‚ÄúVoc√™ definiu uma taxa justa e alinhada √† m√©dia de mercado para este perfil de risco. √ìtimo!‚Äù
    - ‚ÄúEsta taxa de juros √© muito alta para o mercado. Sua oferta pode ficar muito tempo sem interessados.‚Äù
- **Proposta √© criada no banco**:
  - S√≥ ap√≥s a confirma√ß√£o, a oferta/solicita√ß√£o √© registrada em `propostas`.
  - A `taxa_analisada` pode ser salva para auditoria.

#### 5) Fluxo T√©cnico (Front ‚Üî Back)
- **Cria√ß√£o de proposta (investidor ou tomador)**:
  1. **Usu√°rio decide abrir uma nova oferta/solicita√ß√£o**:
     - Ap√≥s consultar o marketplace e n√£o encontrar algo compat√≠vel, o usu√°rio opta por criar sua pr√≥pria proposta.
     - Neste momento, ele j√° informou valor e prazo no front.
  2. **Front solicita recomenda√ß√£o de taxa**:
     - O front envia os par√¢metros tempor√°rios (valor + prazo + score do tomador, se aplic√°vel) para o servi√ßo de recomenda√ß√£o.
     - O dado ainda n√£o foi persistido no banco, √© apenas input de tela.
  3. **Back calcula `taxa_analisada`**:
     - Com base em:
       - Faixa de mercado (m√©dia de taxas por score, derivada internamente a partir do hist√≥rico da plataforma).
       - Hist√≥rico do usu√°rio (taxas m√©dias de propostas anteriores semelhantes, filtradas por valor e prazo pr√≥ximos aos informados).
     - O back retorna:
       - `taxa_analisada` (valor sugerido).
       - `faixa_mercado` (ex.: `[11%, 14%]`) para compara√ß√£o.
  4. **Front exibe recomenda√ß√£o**:
     - Mostra a taxa sugerida (`taxa_analisada`).
     - Mostra mensagens de contexto de acordo com a posi√ß√£o da taxa escolhida pelo usu√°rio em rela√ß√£o √† `faixa_mercado`:
       - Dentro da faixa ‚Üí ‚ÄúTaxa justa e alinhada √† m√©dia de mercado.‚Äù
       - Acima da faixa ‚Üí ‚ÄúTaxa alta, pode demorar a atrair interessados.‚Äù
       - Abaixo da faixa ‚Üí ‚ÄúTaxa agressiva, pode atrair investidores rapidamente, mas avalie se √© sustent√°vel.‚Äù
  5. **Usu√°rio revisa e confirma**:
     - Pode aceitar a taxa sugerida ou definir outra.
     - Tamb√©m revisa demais par√¢metros (valor, prazo, perfis de risco aceitos, possibilidade de negocia√ß√£o).
  6. **Persist√™ncia no banco**:
     - S√≥ ao confirmar, o sistema cria o registro na tabela `propostas`.
     - A `taxa_analisada` pode ser opcionalmente salva em `analise_taxa` para auditoria/analytics, mas n√£o √© campo obrigat√≥rio da proposta.

#### 6) Servi√ßo de Recomenda√ß√£o ‚Äî FastAPI
##### Endpoints
- `GET /internal/recommendations/solicitacoes/{user_id}`
  ‚Üí retorna lista de empr√©stimos/solicita√ß√µes no marketplace, ordenados por compatibilidade com o perfil do usu√°rio (investidor ou tomador).
- `GET /internal/recommendations/taxa?user_id=...&valor=...&prazo=...`
  ‚Üí retorna `taxa_analisada` + faixa de mercado + mensagens de contexto para front exibir ao abrir nova proposta.
- `POST /internal/recommendations/recalculate/{user_id}`
  ‚Üí for√ßa rec√°lculo de m√©tricas do investidor (ex.: diversifica√ß√£o de carteira) e das recomenda√ß√µes de matching.

##### Stack
- FastAPI + Uvicorn.
- SQLAlchemy para m√©tricas de hist√≥rico.
- Redis ‚Üí listener para eventos (assinatura de contratos).

#### 8) Roadmap de Evolu√ß√£o
- **Fase 1 (MVP)**: l√≥gica de regras simples (ranges e m√©dias).
- **Fase 2**: enriquecimento com dados setoriais (agro, servi√ßos, etc.).
- **Fase 3**: poss√≠vel evolu√ß√£o para ML (learning-to-rank, collaborative filtering) caso base cres√ßa e justifique complexidade.

---

## üé® Introdu√ß√£o e Objetivo do Prot√≥tipo no Figma

Este documento detalha o fluxo de navega√ß√£o do **prot√≥tipo de alta fidelidade** do **Negoci.ai**, desenvolvido no **Figma**.

Devido ao tempo limitado do hackathon, nossa estrat√©gia foi focar na prototipa√ß√£o da **jornada principal** e do nosso maior diferencial competitivo: **o fluxo de negocia√ß√£o**.  
- O fluxo do **Investidor** e do **Tomador** foi prototipado em momentos-chave para demonstrar consist√™ncia da interface e vis√£o da intera√ß√£o entre perfis.  

---

## üé® Legenda de Cores e Perfis

Para refor√ßar o contexto da navega√ß√£o, adotamos um sistema de cores consistente:  

- üîµ **Perfil Tomador** ‚Äì Azul `#57d9ff` como cor de destaque e a√ß√£o.  
- üü£ **Perfil Investidor** ‚Äì Roxo `#9B59B6` como cor de destaque e a√ß√£o.  

# Figma

<div align="center">
<sub>Figma</sub>
<img src="./img/print_figma.png" width="100%" >
</div>

# [üëâ Clique aqui para acessar o Figma üëà](https://www.figma.com/design/YlRuYlxMbx0ebh2WVgzVZx/QI-Tech---Hackthon?node-id=0-1&t=v1IXBJMadz2ipSfx-1)
---

## üíµ Modelo de Neg√≥cio e Sustentabilidade Financeira

&emsp;Pela solu√ß√£o se tratar de um Whitelabel, ou seja, uma plataforma que ser√° disponibilizada para que terceiros integrem internamente em suas solu√ß√µes, de forma a disponibilizar o seu uso para seus clientes, o modelo de neg√≥cio √© **B2B2C (Business-To-Business-To-Client)**.

&emsp;Essa estrat√©gia diminui riscos como a dificuldade de aplica√ß√£o de penalidades para inadimplentes, visto que, em um aplicativo isolado da solu√ß√£o, durante algum per√≠odo de inadimpl√™ncia o cliente final poderia se ausentar e dificultar os canais de comunica√ß√£o, o que dificilmente acontece quando a solu√ß√£o √© acoplada a outra como um banco digital, o qual j√° possui seu sistema de seguran√ßa, onboarding antifraude, rastreabilidade dos seus usu√°rios e os mecanismos para facilitar transfer√™ncias e registros de penalidades.

&emsp;Segue tabela de custos e oportunidades com a solu√ß√£o, bem como o detalhamento dos atributos de implementa√ß√£o:

<p align="center">
  <img src="./img/modeloNegocio.png" alt="Imagem com tabela explicando sustentabilidade financeira do negocia.ai" width="100%">
</p>

#### Motor de Score (embutido no mon√≥lito)

&emsp;Considerando uma estimativa mensal de 10.000 novos usu√°rios na solu√ß√£o arquitetada, tem-se os seguintes c√°lculos: 

| Item | Descri√ß√£o | Frequ√™ncia | Estimativa (R$/m√™s) |
|------|-----------|------------|----------------------|
| **Infraestrutura** | Uso do container √∫nico (backend monol√≠tico) + Redis + Postgres | Cont√≠nuo | incluso na infra (~1.800) |
| **Integra√ß√£o Serasa** | Consulta de score de cr√©dito na abertura da conta, com consulta peri√≥dica a cada 3 meses | Vari√°vel (depende n¬∫ de usu√°rios) | 150.000 / a cada 3 meses => 150.000 / 3 = R$ 50.000 mensais |
| **Manuten√ß√£o Modelo** | Re-treino mensal (data scientist) + monitoramento | Recorrente | 8.000 |
| **Seguran√ßa & Compliance** | Armazenamento seguro, LGPD, auditoria | Anual | 20.000 (‚âà1.700/m√™s) |

&emsp;A solu√ß√£o, j√° entregue com parte de seu escopo conclu√≠do, tem Roadmap total de implementa√ß√£o de 4 semanas, 

- Semana 1:  Servi√ßos de front, backend (com motores de recomenda√ß√£o e score), e banco de dados
- Semana 2:  Integra√ß√£o interna e externa (API do Serasa), integra√ß√£o Blockchain
- Semana 3:  Deploy na nuvem
- Semana 4: √öltimos refinamentos

&emsp;Como custo total de implementa√ß√£o para o primeiro m√™s, sem os custos posteriores (e reduzidos) de manuten√ß√£o anual, estima-se o investimento inicial de **R$ 91.000**.

&emsp;Somando-se apenas os seguintes custos de manuten√ß√£o posteriores mensais, tem-se:

| Item | Descri√ß√£o | Frequ√™ncia | Estimativa (R$/m√™s) |
|------|-----------|------------|----------------------|
| **Seguran√ßa & Compliance** | Armazenamento seguro, LGPD, auditoria | Anual | 20.000 (‚âà1.700/m√™s) |
| **Infraestrutura** | Uso do container √∫nico (backend monol√≠tico) + Redis + Postgres | Cont√≠nuo | incluso na infra (~1.800) |
| **Equipe Dev/Data** | Manuten√ß√£o (2 estagi√°rios) | Investimento √∫nico | R$ 7.000 |

&emsp;Portanto, como custo total de manuten√ß√£o, tem-se o total mensal de **R$ 11.000**.

&emsp;Com base em pesquisas de mercado, o valor unit√°rio de integra√ß√£o da nossa solu√ß√£o como Whitelabel √© de **R$ 20.000** por venda. Considerando um cen√°rio anual, o custo de implementa√ß√£o inicial e as vendas subsequentes permitem atingir o ponto de equil√≠brio (break-even) ap√≥s aproximadamente 4 a 5 integra√ß√µes. J√° a partir da primeira venda, √© poss√≠vel cobrir os custos mensais de manuten√ß√£o, garantindo sustentabilidade financeira ao neg√≥cio.

#### Considera√ß√µes Importantes

- Arquitetura baseada em **mon√≥lito containerizado na AWS** ‚Üí simplifica custos de infra e orquestra√ß√£o.  
- Infraestrutura compartilhada (container, banco, Redis) ‚Üí nada de microsservi√ßos isolados neste est√°gio.  
- Estimativas baseadas em **MVP com 5k‚Äì10k usu√°rios ativos/m√™s**.  
- **Score**: recalculado 1x/dia por usu√°rio ativo (batch).  
- **Recomenda√ß√£o**: usado on-demand ao abrir/criar propostas.  
- **Consultas Serasa**: assumem cache de 24h, custo m√©dio R$ 1‚Äì2 por requisi√ß√£o.  
- Principais custos v√™m de **equipe de desenvolvimento/data science** e **integra√ß√£o externa**.  
- Modelo pensado para **simplicidade e velocidade no MVP**; no futuro pode evoluir para microsservi√ßos se a escala justificar.

### üíµ **Fontes de Receita do Negocia.ai**

#### 1) Taxa sobre cada empr√©stimo
- Atrav√©s da venda de planos de implementa√ß√£o personalizados da solu√ß√£o Whitelabel, com pre√ßo inicial definido a partir de pesquisas de mercado, atualmente estimado em **R$ 20.000** por integra√ß√£o.

#### 2) Taxa sobre cada empr√©stimo
- **Descri√ß√£o**: cobran√ßa de uma taxa de intermedia√ß√£o em cada parcela de empr√©stimo fechado. Futuramente, poder√° ser implementada uma API que registra todas as transa√ß√µes de empr√©stimo do aplicativo e, negociando-se valores de taxas por empr√©stimo, ser√° emitida uma fatura mensal com os valores e encargos combinados.  
- **Modelo poss√≠vel**: percentual sobre o valor do empr√©stimo (ex.: 1%‚Äì3%, conforme acordado entre Negocia.ai x Cliente e conforme formalidades regulat√≥rias).

#### 3) Cobran√ßa por inadimpl√™ncia
- **Descri√ß√£o**: taxa administrativa aplicada em casos de atraso, para cobrir custos de cobran√ßa e eventual registro em bureaus de cr√©dito (ex.: Serasa).  
- **Objetivo**: compensar o risco operacional e desestimular o atraso.

#### 4) Parcerias com empresas/servi√ßos
- **Descri√ß√£o**: acordos com terceiros para gera√ß√£o de receita indireta, como:  
  - Seguradoras (prote√ß√£o contra inadimpl√™ncia).  
  - Bureaus de cr√©dito (consultas adicionais).  
  - Institui√ß√µes financeiras (wallets digitais, cust√≥dia).  
- **Objetivo**: diversificar receitas sem onerar diretamente a opera√ß√£o principal.

#### 5) Reten√ß√£o de porcentagem de lucro na antecipa√ß√£o de receb√≠veis
- **Descri√ß√£o**: ao oferecer a funcionalidade de antecipa√ß√£o de receb√≠veis para clientes, a plataforma pode reter uma porcentagem do lucro gerado nessa opera√ß√£o. Essa taxa √© aplicada sobre o valor antecipado, funcionando como remunera√ß√£o pelo servi√ßo de liquidez imediata.
- **Objetivo**: criar uma fonte adicional de receita, aproveitando o fluxo de opera√ß√µes de antecipa√ß√£o e agregando valor ao cliente ao mesmo tempo em que monetiza o servi√ßo.
- **Modelo poss√≠vel**: percentual fixo ou vari√°vel sobre o valor antecipado, conforme acordado em contrato (ex.: 1%‚Äì2% por opera√ß√£o).

--- 

## üîó Uso da Blockchain Polkadot e Smart Contracts

### 1. Por que Blockchain (e por que Polkadot)

Imagine o cen√°rio: Carlos (tomador) e Sofia (investidora) negociam um empr√©stimo dentro do app.  
Tudo corre bem at√© surgiram algumas d√∫vidas: **"Ser√° que os termos aceitos s√£o exatamente esses? Ser√° que essa transa√ß√£o realmente foi oficializada?"**  

Tradicionalmente, seria preciso um contrato em papel, custas cartoriais ou confian√ßa cega na plataforma. Contudo, aqui entra a vantagem de se utilizar blockchain: cada negocia√ß√£o aceita √© registrada como um **carimbo digital imut√°vel** na **Polkadot**, uma rede p√∫blica, barata e confi√°vel.  

Isso garante que:
- O **tomador** tem certeza de que as condi√ß√µes que aceitou s√£o as que ser√£o cumpridas.  
- O **investidor** confia que sua decis√£o est√° registrada de forma transparente e incontest√°vel.  
- A **plataforma** se posiciona como um √°rbitro neutro, sem poder manipular acordos e controlando a cust√≥dia de valores conforme os termos combinados.  

Este tipo de utiliza√ß√£o garante mais mais confian√ßa, menos burocracia, custo muito menor que cart√≥rios ou sistemas tradicionais. A Blockchain de escolha, considerando o cen√°rio da nossa solu√ß√£o, foi a Polkadot, j√° que ela oferece algumas vantagens:

- **Custos baixos**: transa√ß√µes custam centavos de d√≥lar.  
- **Popularidade**: ampla aceita√ß√£o no ecossistema Web3.  
- **Compat√≠vel com ERC-4337 (Account Abstraction)**: permite login com e-mail (Web3Auth), dispensando a gest√£o manual de chaves privadas pelo usu√°rio.  

### 2. Decis√µes de design da blockchain pro MVP

- **On-chain**: registramos apenas um **hash da negocia√ß√£o** (evento-only), suficiente como prova p√∫blica.  
- **Off-chain**: todos os dados sens√≠veis (nome, CPF, score, hist√≥rico, valores) ficam no banco relacional (armazenado em nuvem, atrav√©s do banco RDS).  
- **Wallet autom√°tica**: criada ou logada (caso existente) para o usu√°rio via **Web3Auth** + **Account Abstraction**, simplificando a experi√™ncia, j√° que o usu√°rio n√£o passa pelo atrito de necessidade de gerenciamento de blockchain.  
- **Backend**: garante integridade (gera o hash can√¥nico) e audita o status da transa√ß√£o.  

Em termos de neg√≥cio:  
- Reduzimos custo (pagando apenas por eventos de registro de empr√©stimo na blockchain).  
- Ganhamos a **for√ßa de uma evid√™ncia p√∫blica** em caso de disputas.  
- Entregamos ao usu√°rio uma sensa√ß√£o de **seguran√ßa compar√°vel a um cart√≥rio**, mas em segundos e dentro do app.

---

## Fluxo resumido de uso

1. **Onboarding**: Carlos cria conta com e-mail ‚Üí app detecta que ele n√£o tem uma smart wallet, portanto, gera uma automaticamente.  
2. **Perfil**: o backend consulta score do Serasa e cruza com hist√≥rico de uso.  
3. **Negocia√ß√£o**: Carlos e Sofia trocam propostas at√© chegarem a um acordo.  
4. **Registro on-chain**: o backend gera um `termsHash`, e a smart wallet do usu√°rio assina o envio.  
5. **Confirma√ß√£o**: a blockchain devolve um `tx_hash`, que √© armazenado no banco e exibido para ambos.  

Assim, Carlos sabe que o contrato dele est√° **protegido contra altera√ß√µes**, e Sofia sabe que sua decis√£o est√° **publicamente comprovada**.

## An√°lise de Custos Financeiros da Blockchain

### Premissas do Cen√°rio
- **Usu√°rios ativos**: 5.000  
- **Empr√©stimos/m√™s por usu√°rio**: 5 (cen√°rio improv√°vel, mas bom para stress test)  
- **Total transa√ß√µes/m√™s** = 5.000 √ó 5 = **25.000**  
- **Total transa√ß√µes/ano** = 25.000 √ó 12 = **300.000**  

Cada transa√ß√£o corresponde ao **registro on-chain do hash da negocia√ß√£o** (evento-only).  
O custeio do gas ser√° patrocinado pela solu√ß√£o, via **Paymaster**, evitando preocupa√ß√µes de custos do usu√°rio.  

---

### 1. Custos de Gas ‚Äì Polkadot
- **Gas m√©dio por evento**: 50.000 gas  
- **Gas price m√©dio**: 30 gwei (0,00000003 MATIC)  
- **Custo por transa√ß√£o** = 50.000 √ó 30 gwei = **0.0015 MATIC**  
- **Convers√£o (MATIC ~ US$ 0.50)** ‚Üí **US$ 0.00075 por transa√ß√£o**

Totais:
- **Mensal (25.000 tx)** ‚âà **US$ 18,75**  
- **Anual (300.000 tx)** ‚âà **US$ 225,00**

---

## 2. Custos de Identidade ‚Äì Web3Auth (AA + MPC)
- Free tier at√© 1.000 MAUs.  
- Estimativa: **US$ 0.05 / usu√°rio ativo**.  

Totais:
- **Mensal (5.000 usu√°rios)** ‚âà **US$ 250**  
- **Anual** ‚âà **US$ 3.000**


---

## üîó Deploy, testes locais e justificativa t√©cnica (Hardhat)

- A testnet Paseo (Polkadot Asset Hub) apresentou instabilidade no RPC p√∫blico e rejei√ß√£o de transa√ß√µes (ex.: "Invalid Transaction" / code 1010). Isso ocorre no n√≥ da testnet antes do deploy (nonce/gas/formato incompat√≠vel com o pallet Substrate/EVM). Portanto o problema foi infra.
- Plano autorizado pelo regulamento do Hackathon: testar e validar localmente em um Hardhat Node (EVM). Hardhat emula o EVM utilizado por redes compat√≠veis e √© o ambiente usado por times para testes de contratos antes do deploy real. O contrato e o backend permanecem compat√≠veis com Paseo e podem ser deployados na testnet assim que o RPC voltar ao ar.

### Justificativa t√©cnica detalhada

- Erro observado: ValueError: {'code': 1010, 'message': 'Invalid Transaction'} ‚Äî o node p√∫blico da Paseo rejeita a transa√ß√£o antes de ela ser inclu√≠da. Causas poss√≠veis: nonce discrepante, formato de tx incompat√≠vel com o pallet EVM customizado do Substrate, regras de gas/limit diferentes.
- A rede Paseo tem suporte EVM, mas a implementa√ß√£o testnet estava inst√°vel. Reproduzir e validar localmente com Hardhat √© uma pr√°tica aceita e recomendada quando a infra externa est√° indispon√≠vel. O hackathon aceita isso desde que:
  - O contrato seja funcional em um ambiente EVM (Hardhat, Remix, Ganache etc.).
  - O reposit√≥rio inclua instru√ß√µes claras de deploy e um UI que demonstre integra√ß√£o on‚Äëchain (/test).

### O que foi implementado

- Smart contract: `src/backend/src/app/hardhat/contracts/ContratoExemplo.sol` ‚Äî contrato exemplo para registrar hashes e armazenar um campo de `contractData` para demonstra√ß√£o. A fun√ß√£o `registrar(bytes32, string)` registra um hash on‚Äëchain e emite evento com `data`.
 - Contratos da solu√ß√£o:
   - `src/backend/src/app/hardhat/contracts/Emprestimo.sol` ‚Äî contrato espec√≠fico para registrar on‚Äëchain o `contrato_tx_hash` de um empr√©stimo; exp√µe `registrar(bytes32,string)` e um getter `consultarHash()`.
   - `src/backend/src/app/hardhat/contracts/AntecipacaoRecebiveis.sol` ‚Äî contrato para registrar `contrato_antecipacao_onchain` (antecipa√ß√£o de receb√≠veis); exp√µe `registrarAntecipacao(bytes32,string)` e `consultarHashAntecipacao()`.
- Backend (FastAPI): `src/backend/src/app/services/blockchain.py` ‚Äî fun√ß√µes para compilar, persistir artefatos ABI (ContratoExemplo_abi.json), deployar (`/blockchain/deploy`), compilar (`/blockchain/compile`), chamar `registrar` no contrato (`/blockchain/registrar`), e checar se um endere√ßo tem c√≥digo on‚Äëchain (is_contract_onchain). Tamb√©m inclui um helper `get_contract_data(address)` que tenta ler `contractData()` do contrato quando dispon√≠vel.
- API (routers): `src/backend/src/app/api/routers.py` ‚Äî endpoints expostos ao frontend:
  - GET /blockchain/status ‚Äî informa se h√° ABI local, endere√ßo do contrato, e, quando poss√≠vel, o valor de `contract_data` lido do contrato em chain.
  - GET /blockchain/compile ‚Äî for√ßa compila√ß√£o do contrato e grava o arquivo `ContratoExemplo_abi.json` no backend.
  - POST /blockchain/deploy ‚Äî compila & deploya o contrato usando a chave do deployer do servidor (DEPLOYER_PRIVATE_KEY) e persiste ABI + address.
  - POST /blockchain/registrar ‚Äî recebe JSON { contrato_hash: string, data?: string } e chama o m√©todo `registrar` do contrato (tenta a assinatura com o campo `data`, com fallback para a vers√£o sem `data` se ABI divergir). Retorna receipt serializado.
  - GET /blockchain/address/{address}/status ‚Äî retorna balance/nonce/has_code para um endere√ßo.
- Frontend: `src/frontend/src/pages/Test.tsx` ‚Äî p√°gina `/test` com UI para:
  - Verificar status da integra√ß√£o (deployer, ABI e endere√ßo salvos localmente, e leitura de contract_data quando dispon√≠vel).
  - Compilar o contrato e baixar/ver o ABI JSON.
  - Deploy (disparado pelo backend usando a chave do servidor).
  - Registrar um hash on‚Äëchain e enviar um campo `data` adicional; ver o receipt e a prova on‚Äëchain.
  - Visualizar / copiar a √∫ltima tx e ver se ela est√° na chain.

### Arquitetura de execu√ß√£o (Docker)

O reposit√≥rio j√° inclui um `src/docker-compose.yml` que levanta tudo para desenvolvimento:

- Servi√ßo `hardhat`: roda `npx hardhat node` e exp√µe o RPC em `8545` dentro da rede Docker.
- Servi√ßo `backend`: FastAPI que aponta `POLKADOT_HUB_RPC_URL` para `http://hardhat:8545` (veja `src/docker-compose.yml`).
- Servi√ßo `postgres`: banco de dados usado localmente.

1) Verificar status (GET)

- URL: http://localhost:8000/blockchain/status
- O que retorna: se existe ABI local, deployer address (do .env), se o contrato est√° on‚Äëchain (verificando c√≥digo no endere√ßo) e, quando poss√≠vel, o `contract_data` retornado pela chamada ao contrato.

2) Compilar (GET)

- URL: http://localhost:8000/blockchain/compile
- O que faz: compila o contrato, grava `ContratoExemplo_abi.json` em `src/backend/src/app/ContratoExemplo_abi.json` e retorna o JSON da ABI/bytecode.

3) Deploy (POST)

- URL: http://localhost:8000/blockchain/deploy
- O que faz: compila (se necess√°rio) e deploya o contrato usando a chave do servidor (DEPLOYER_PRIVATE_KEY). Retorna receipt e grava `CONTRACT_ADDRESS`/ABI localmente.

4) Registrar hash (POST)

- URL: http://localhost:8000/blockchain/registrar
- Body JSON: { "contrato_hash": "0x...", "data": "texto opcional pra prova" }
- O que faz: chama `registrar(hash, data)` no contrato (tenta com 2 args e faz fallback se ABI for a vers√£o antiga). Retorna receipt serializado com logs (o `data` deve aparecer no evento quando enviado corretamente).

5) Checar endere√ßo (GET)

- URL: http://localhost:8000/blockchain/address/<address>/status
- O que faz: retorna balance/nonce/has_code do endere√ßo.

### Como testar passo a passo (end‚Äëto‚Äëend)

Checklist essencial:

1. Clonar reposit√≥rio e abrir terminal no diret√≥rio do projeto.
2. Ir para `src/` e rodar `docker-compose up --build` (PowerShell: `cd src; docker-compose up --build`).
3. Verificar vari√°veis de ambiente (arquivo `.env` usado pelo container `backend`). Veja a se√ß√£o ".env necess√°ria" abaixo.
4. Acessar a p√°gina de frontend (se o frontend estiver exposto) ou usar as rotas via curl/Postman:
   - GET http://localhost:8000/blockchain/status
   - GET http://localhost:8000/blockchain/compile
   - POST http://localhost:8000/blockchain/deploy
   - POST http://localhost:8000/blockchain/registrar body { contrato_hash, data }
5. Abrir a p√°gina `/test` no frontend e usar a UI para compilar, deployar e registrar.

### .env necess√°ria (valores m√≠nimos)

Adicione (ou verifique) estas chaves no `.env` que o `backend` usa (o `docker-compose` j√° referencia `../.env` do `src/`):

- DEPLOYER_PRIVATE_KEY ‚Äî chave privada do deployer (somente para testes em desenvolvimento/local). Exemplo: uma chave do Hardhat.
- CONTRACT_ADDRESS ‚Äî (opcional) endere√ßo do contrato se j√° foi deployado manualmente.
- POLKADOT_HUB_RPC_URL ‚Äî por padr√£o configurado para `http://hardhat:8545` no docker-compose.
- POLKADOT_HUB_CHAIN_ID ‚Äî chain id; default 31337 para o Hardhat Node.

### Arquivos/artifacts gerados e caminhos

- ABI persistida: `src/backend/src/app/ContratoExemplo_abi.json` ‚Äî o backend grava esse arquivo ap√≥s compilar ou ap√≥s deploy.
- Smart contract: `src/backend/src/app/hardhat/contracts/ContratoExemplo.sol`.


### Limita√ß√µes conhecidas

- Paseo RPC: a testnet Paseo pode rejeitar transa√ß√µes publicamente (erro 1010). Por isso usamos Hardhat local. Assim que o endpoint Paseo voltar a funcionar, o c√≥digo est√° pronto para deploy.
- Decodifica√ß√£o de logs: dependendo do node, `receipt.logs[].data` pode vir em formatos diferentes (hex). O backend tenta serializar logs e extrair `data`/eventos onde for poss√≠vel, mas em alguns casos pode ser necess√°rio decodificar manualmente com a ABI.
- Chaves privadas: o backend mant√©m a chave do deployer via vari√°veis de ambiente (n√£o armazene chaves de usu√°rios). Na arquitetura final, essa chave deve ficar em um secret manager.

### Boas pr√°ticas e justificativas de arquitetura

- Hardhat local √© uma pr√°tica padr√£o para testes E2E de contratos ‚Äî n√£o √© um "atalho". Ele reproduz o EVM e permite que o time valide comportamento antes do deploy em redes p√∫blicas.
- Persist√™ncia do ABI local facilita a integra√ß√£o com o frontend sem depender de resposit√≥rios externos.
- O backend √© o √∫nico respons√°vel por deploys (deploy por servidor) para evitar armazenar chaves de usu√°rio.

---

## üìà Planos Futuros e Evolu√ß√£o da Plataforma

Para garantir que o *Negoci.ai* continue na vanguarda da inova√ß√£o em empr√©stimos P2P, planejamos tr√™s grandes evolu√ß√µes para o futuro da plataforma, focadas em torn√°-la mais inclusiva, inteligente e precisa.

---

### 2Ô∏è‚É£ Intelig√™ncia de Nicho ‚Äì Modelo de Recomenda√ß√£o por √Årea de Atua√ß√£o

*üìå O Que √©?*  
Um modelo de Machine Learning que vai al√©m do score de cr√©dito. Ele analisa a *√°rea de atua√ß√£o profissional do tomador* e os *interesses do investidor* para sugerir taxas ainda mais personalizadas.

**‚öô Como Funciona no Negoci.ai?**  
- Aprende com dados hist√≥ricos quais √°reas profissionais (ex.: TI, Sa√∫de, Engenharia) t√™m menor inadimpl√™ncia.  
- Sugere taxas com base no nicho profissional.  

*üßë‚Äçüíª Exemplo para o Tomador (Carlos):*  
"Profissionais de TI como voc√™ costumam conseguir taxas pr√≥ximas a 1.2% a.m. Sua proposta √© muito competitiva!"  

*üë©‚Äçüíº Exemplo para a Investidora (Sofia):*  
"Este tomador √© da √°rea de Engenharia. Investidores com seu perfil costumam ter sucesso com ofertas de 1.5% a.m. para este nicho."  

*üéØ Impacto e Vantagens*  
- *Hiper-personaliza√ß√£o* ‚Äì Taxas mais inteligentes e relevantes.  
- *Comunidades de Investimento* ‚Äì Cria√ß√£o de nichos de afinidade entre investidores e tomadores.  
- *Precis√£o de Risco* ‚Äì Adiciona uma camada setorial e comportamental ao risco.  

---

### 3Ô∏è‚É£ An√°lise de Risco 360¬∞ ‚Äì Integra√ß√£o com Open Finance

*üìå O Que √©?*  
Integra√ß√£o com o *Open Finance Brasil, permitindo que usu√°rios compartilhem seus dados financeiros (com consentimento) com o **Negoci.ai*.

**‚öô Como Funciona no Negoci.ai?**  
- Durante cadastro ou solicita√ß√£o, o usu√°rio pode conectar suas contas banc√°rias.  
- Dados s√£o usados para:  
  - *Aprimorar o Modelo de Cr√©dito* ‚Äì Treinar o model_analise_credito.py com dados reais.  
  - *Validar Renda Automaticamente* ‚Äì Eliminando preenchimento manual.  
  - *Calcular M√©tricas Avan√ßadas* ‚Äì Analisar gastos, investimentos e d√≠vidas.  

*üéØ Impacto e Vantagens*  
- *Redu√ß√£o de Fraudes* ‚Äì Dados validados via Open Finance.  
- *Confian√ßa M√°xima para o Investidor* ‚Äì Perfis com hist√≥rico financeiro completo.  
- *Melhores Taxas para o Tomador* ‚Äì Mais poder de negocia√ß√£o com perfil validado.  
